"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3934],{33934:(e,t,l)=>{l.r(t),l.d(t,{default:()=>Z});var i=l(95155),r=l(12115),a=l(79111),n=l(41995),s=l(50109),o=l(45191),c=l(4904),d=l(72630),u=l(58888),h=l(71734),f=l(6828),g=l(81838),m=l(7545),p=l(96565),x=l(42028),v=l(52594),b=l(37918),y=l(53728),j=l(85204);let w=e=>{let{className:t="w-4 h-4"}=e;return(0,i.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})};function F(e,t){return"string"==typeof e?t:Array.isArray(e)?0===e.length||"string"==typeof e[0]?t:e[0].unit||t:e.unit||t}let A=(e,t)=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(e)){let l=new Date(e);if(!isNaN(l.getTime())){if((null==t?void 0:t.timeFilter)==="D"||(null==t?void 0:t.timeFilter)==="W");else if((null==t?void 0:t.timeFilter)==="M")return l.toLocaleDateString("en-US",{month:"short"});else if((null==t?void 0:t.timeFilter)==="Q"){let e=Math.floor(l.getMonth()/3)+1;return"Q".concat(e)}else if((null==t?void 0:t.timeFilter)==="Y")return l.getFullYear().toString();return l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return/^Q[1-4]\s\d{4}$/.test(e)?e.substring(0,2):/^[A-Za-z]{3}\s\d{4}$/.test(e)?e.substring(0,3):e.length<=5?e:"".concat(e.substring(0,3),"...")},k=r.memo(e=>{let{chartConfig:t,data:l,width:k=500,height:N=300,isExpanded:M=!1,onCloseExpanded:S,colorMap:C,filterValues:D,yAxisUnit:O}=e,E=(0,r.useRef)(null),L=(0,r.useRef)(null),[T,z]=(0,r.useState)(null),[V,B]=(0,r.useState)([]),[R,W]=(0,r.useState)(!1),[$,U]=(0,r.useState)(null),[P,_]=(0,r.useState)([]),[q,Y]=(0,r.useState)([]),[Z,Q]=(0,r.useState)({visible:!1,left:0,top:0,key:"",items:[]}),[I,K]=(0,r.useState)(!1),[H,J]=(0,r.useState)(null),[X,G]=(0,r.useState)(D||{}),[ee,et]=(0,r.useState)(!1),el=t.dataMapping.xAxis,ei=t.dataMapping.yAxis,er="string"==typeof el?el:el[0],ea=(0,r.useCallback)(e=>"string"==typeof e?e:e.field,[]),en=(0,r.useMemo)(()=>Array.isArray(ei)&&ei.length>1,[ei]),es=(0,r.useMemo)(()=>"string"==typeof ei?[ei]:Array.isArray(ei)?ei.map(e=>ea(e)):[],[ei,ea]),eo=es[0],ec=(0,r.useCallback)((e,t)=>{let l;if(null==e)return"0.00";let i=t||"",r=i&&"%"!==i&&"SOL"!==i;return(l=e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e.toFixed(2),i)?r?"".concat(i).concat(l):"".concat(l,"\xa0").concat(i):l},[]),ed=(0,r.useCallback)(e=>{if(0===e)return"0";if(e>=1e9){let t=(e/1e9).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"B"):"".concat(t,"B")}if(e>=1e6){let t=(e/1e6).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"M"):"".concat(t,"M")}if(!(e>=1e3))return e.toFixed(0);{let t=(e/1e3).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"K"):"".concat(t,"K")}},[]);(0,r.useEffect)(()=>{D&&G(D)},[D]),(0,r.useEffect)(()=>{et(!0)},[]);let eu=(0,r.useCallback)(()=>{t.onFilterChange&&t.onFilterChange(D||{}),z(null)},[D,t]),{chartData:eh,barColor:ef}=(0,r.useMemo)(()=>{let e=M&&I&&q.length>0?q:!M&&R&&P.length>0?P:l;if(M&&console.log("Modal chart data source:",I&&q.length>0?"modal filtered data":"full data","Count:",e.length),!e||0===e.length)return{chartData:[],barColor:f.z1};let i=C||{},r=!t.useDistinctColors,a=e.filter(e=>void 0!==e[er]&&null!==e[er]);if(a.length>0&&"string"==typeof a[0][er]&&(a[0][er].match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{4}$/.test(a[0][er])||/^\d{4}$/.test(a[0][er]))&&a.sort((e,t)=>{let l=new Date(e[er]),i=new Date(t[er]);return l.getTime()-i.getTime()}),en){let e={};es.forEach((t,l)=>{e[t]=i[t]||(0,f.Vy)(l)});let t={};return a.forEach(e=>{let l=String(e[er]);t[l]?es.forEach(i=>{void 0!==e[i]&&(void 0===t[l][i]||Number(e[i])>Number(t[l][i]))&&(t[l][i]=e[i])}):(t[l]={[er]:e[er]},es.forEach(i=>{t[l][i]=void 0!==e[i]?e[i]:0}))}),{chartData:Object.values(t),barColor:e}}{let e={};a.forEach(t=>{let l=String(t[er]);e[l]?(Number(t[eo])||0)>(Number(e[l][eo])||0)&&(e[l]=t):e[l]={...t}});let t=Object.values(e);if(console.log("Processed ".concat(a.length," items into ").concat(t.length," unique data points")),r)return{chartData:t,barColor:i[eo]||f.z1};{let e={};return t.forEach((t,l)=>{let r=String(t[er]);e[r]=i[r]||(0,f.Vy)(l%f.h8.length)}),{chartData:t,barColor:e}}}},[l,P,q,R,I,er,eo,t,en,es,C,M]),eg=(0,r.useCallback)(()=>{Z.visible&&Q(e=>({...e,visible:!1}))},[Z.visible]),em=(0,r.useCallback)(function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null==(t=(i?L:E).current)?void 0:t.getBoundingClientRect();if(!r)return;let a=e.clientX-r.left,n=e.clientY-r.top;if(0===(i?I&&q.length>0?q:l:R&&P.length>0?P:l).length)return;let s={right:15,left:40},o=r.width-s.left-s.right,c=a-s.left;if(c<0||c>o){Z.visible&&Q(e=>({...e,visible:!1}));return}let d=Math.floor(c/(o/eh.length));if(d<0||d>=eh.length){Z.visible&&Q(e=>({...e,visible:!1}));return}let u=eh[d];if(!u){Z.visible&&Q(e=>({...e,visible:!1}));return}let h=u[er],g=Math.max(n-10,10);if(Z.visible&&Z.key===h)Q(e=>({...e,left:a,top:g}));else{let e=[];en?0===(e=es.filter(e=>{let t=Number(u[e]);return!isNaN(t)&&t>0}).map(e=>({label:e,value:ec(Number(u[e])||0,F(ei,O)),color:"string"==typeof ef?ef:ef[e]||f.z1,shape:"square"})).sort((e,t)=>{let l="string"==typeof e.value?parseFloat(e.value.replace(/[^0-9.-]+/g,"")):e.value;return("string"==typeof t.value?parseFloat(t.value.replace(/[^0-9.-]+/g,"")):t.value)-l})).length&&es.length>0&&(e=[{label:es[0],value:"$0.00",color:"string"==typeof ef?ef:ef[es[0]]||f.z1,shape:"square"}]):e=[{label:eo,value:ec(u[eo],F(ei,O)),color:"string"==typeof ef?ef:ef[u[er]]||f.z1,shape:"square"}],Q({visible:!0,key:h,items:e,left:a,top:g})}},[l,P,q,R,I,eh,er,eo,es,ef,ec,Z.visible,Z.key,en,O]),ep=(0,r.useMemo)(()=>{if(!l||0===l.length)return[];console.log("Creating brush data with",l.length,"items");let e=[...l].filter(e=>void 0!==e[er]&&null!==e[er]);e.length>0&&"string"==typeof e[0][er]&&(e[0][er].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[0][er])||/^[A-Za-z]{3}\s\d{4}$/.test(e[0][er])||/^\d{4}$/.test(e[0][er]))&&e.sort((e,t)=>{let l=new Date(e[er]),i=new Date(t[er]);return l.getTime()-i.getTime()});let t=new Date;if(t.setHours(0,0,0,0),!D||0===Object.keys(D).length){console.log("Processing simple chart without filters");let l={};e.forEach(e=>{let t=String(e[er]);l[t]?(Number(e[eo])||0)>(Number(l[t][eo])||0)&&(l[t]=e):l[t]=e});let i=Object.values(l);console.log("Processed ".concat(e.length," brush items into ").concat(i.length," unique data points"));let r=i.map((e,l)=>{let i;"string"==typeof e[er]&&(e[er].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[er])||/^[A-Za-z]{3}\s\d{4}$/.test(e[er])||/^\d{4}$/.test(e[er]))?isNaN((i=new Date(e[er])).getTime())&&(i=new Date(t)).setDate(t.getDate()+l):e[er]instanceof Date?i=e[er]:(i=new Date(t)).setDate(t.getDate()+l);let r=Number(e[eo]);return{date:i,value:isNaN(r)?0:r,idx:l,originalIndex:l,originalData:e}});return console.log("Created brush data points for simple chart:",r.length),r}let i=e.map((e,l)=>{let i;"string"==typeof e[er]&&(e[er].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[er])||/^[A-Za-z]{3}\s\d{4}$/.test(e[er])||/^\d{4}$/.test(e[er]))?isNaN((i=new Date(e[er])).getTime())&&(i=new Date(t)).setDate(t.getDate()+l):e[er]instanceof Date?i=e[er]:(i=new Date(t)).setDate(t.getDate()+l);let r=Number(e[eo]);return(null==r||isNaN(r))&&(r=0),{date:i,value:r,idx:l,originalIndex:l,originalData:e}});return console.log("Created brush data points:",i.length),i},[l,er,eo,D]),ex=(0,r.useCallback)(e=>{if(!e){R&&(U(null),W(!1),_([]));return}let{x0:t,x1:l}=e;console.log("Brush change:",new Date(t),"to",new Date(l)),U([new Date(t),new Date(l)]);let i=ep.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l));console.log("Selected brush items:",i.length);let r=i.map(e=>e.originalData);console.log("Filtered data after brush:",r.length),_(r),R||W(!0)},[R,ep]),ev=(0,r.useCallback)(e=>{if(!e){I&&(J(null),K(!1),Y([]));return}let{x0:t,x1:l}=e;console.log("Modal brush change:",new Date(t),"to",new Date(l)),J([new Date(t),new Date(l)]);let i=ep.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l));console.log("Selected modal brush items:",i.length);let r=i.map(e=>e.originalData);console.log("Filtered data after modal brush:",r.length),Y(r),I||K(!0)},[I,ep]);(0,r.useEffect)(()=>{M&&(console.log("Modal opened, syncing brush domains"),J($),K(R),R&&P.length>0&&(console.log("Syncing filtered data to modal:",P.length,"items"),Y(P)))},[M,$,R,P]);let eb=(0,r.useMemo)(()=>eh&&0!==eh.length?Math.max(...eh.map(e=>Number(e[eo])||0),1):1,[eh,eo]),ey=(0,r.useCallback)(function(e,t){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(T||0===eh.length)return(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,i.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:T||"No data available"}),(0,i.jsx)(m.A,{onClick:eu,children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(w,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:"Refresh"})]})})]});let a={top:10,right:15,bottom:30,left:40},p=e-a.left-a.right,x=t-a.top-a.bottom;if(p<=0||x<=0)return null;let v=(0,o.A)({domain:eh.map(e=>e[er]),range:[0,p],padding:.2}),b=en?Math.max(...eh.flatMap(e=>es.map(t=>Number(e[t])||0)),1):Math.max(...eh.map(e=>Number(e[eo])||0),1),y=(0,c.A)({domain:[0,1.1*b],range:[x,0],nice:!0,clamp:!0}),j=(()=>{if(eh.length>0&&"string"==typeof eh[0][er]&&(/^\d{4}-\d{2}-\d{2}/.test(eh[0][er])||/^\d{2}\/\d{2}\/\d{4}/.test(eh[0][er])||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(eh[0][er])||/^[A-Za-z]{3}\s\d{4}$/.test(eh[0][er])||/^\d{4}$/.test(eh[0][er]))&&eh.length>8){let e=Math.ceil(eh.length/8);return eh.filter((t,l)=>l%e==0).map(e=>e[er])}return eh.map(e=>e[er])})();return(0,i.jsxs)("div",{className:"relative w-full h-full",onMouseMove:e=>em(e,l),onMouseLeave:eg,ref:l?L:E,children:[Z.visible&&Z.items&&!l&&(0,i.jsx)(g.A,{title:String(Z.key),items:Z.items,left:Z.left,top:Z.top,isModal:!1,timeFilter:null==D?void 0:D.timeFilter,currencyFilter:null==D?void 0:D.currencyFilter}),(0,i.jsx)("svg",{width:e,height:t,children:(0,i.jsxs)(n.A,{left:a.left,top:a.top,children:[(0,i.jsx)(s.A,{scale:y,width:p,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),(0,i.jsx)(d.A,{top:x,scale:v,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickValues:j,tickFormat:e=>{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==D?void 0:D.timeFilter)==="D"||(null==D?void 0:D.timeFilter)==="W");else if((null==D?void 0:D.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==D?void 0:D.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==D?void 0:D.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}if(/^\d{2}\/\d{2}\/\d{4}/.test(e)&&!isNaN(new Date(e).getTime()))return A(e,D);if(/^Q[1-4]\s\d{4}$/.test(e))return e.substring(0,2);if(/^[A-Za-z]{3}\s\d{4}$/.test(e))return e.substring(0,3)}return A(String(e),D)},tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),left:0}),(0,i.jsx)(u.A,{scale:y,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!1,numTicks:5,tickFormat:e=>ed(Number(e)),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.25em"})}),en?eh.map(e=>{let t=v(e[er])||0,l=v.bandwidth()/es.length;return(0,i.jsx)(r.Fragment,{children:es.map((r,a)=>{let n=x-y(Number(e[r])||0),s=x-n,o="object"==typeof ef?ef[r]||f.z1:ef;return(0,i.jsx)(h.A,{x:t+a*l,y:s,width:l,height:n,fill:o,opacity:Z.visible&&Z.key===e[er]?1:.8,rx:2},"bar-".concat(e[er],"-").concat(r))})},"multi-".concat(e[er]))}):eh.map((e,t)=>{let l=v(e[er])||0,r=v.bandwidth(),a=x-y(Number(e[eo])||0),n=x-a,s="string"==typeof ef?ef:ef[e[er]]||f.z1;return(0,i.jsx)(h.A,{x:l,y:n,width:r,height:a,fill:s,opacity:Z.visible&&Z.key===e[er]?1:.8,rx:2},"bar-".concat(t))})]})})]})},[eh,er,eo,es,ef,ed,T,eu,Z,em,eg,en,D]);(0,r.useEffect)(()=>{eh.length>0&&(en?B(es.map(e=>({id:e,label:e,color:"string"==typeof ef?ef:ef[e]||f.z1}))):B([{id:eo,label:eo,color:"string"==typeof ef?ef:f.z1}]))},[eh,eo,ef,en,es]);let ej=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!ep||0===ep.length)return null;let t=!D||0===Object.keys(D).length,l=t?-.5:0;return(0,i.jsx)("div",{className:"h-[18%] w-full mt-2",children:(0,i.jsx)(x.A,{data:ep,activeBrushDomain:e?H:$,onBrushChange:e?ev:ex,onClearBrush:()=>{e?(J(null),K(!1),Y([])):(U(null),W(!1),_([]))},getDate:e=>e.date,getValue:e=>{if(t){let t=e.originalIndex;if(eh[t])return Math.max(Number(eh[t][eo])||0,.05*eb)}return e.value},lineColor:t?"#3b82f6":"#60a5fa",margin:{top:10,right:15+l,bottom:e?10:20,left:40+l},isModal:e,curveType:en?"catmullRom":t?"linear":"monotoneX",strokeWidth:en?2:1.5,filterValues:e?X:D})})},[ep,H,$,ev,ex,J,K,Y,U,W,_,eh,eo,D,eb,en,X]),ew=(0,r.useCallback)((e,l)=>{let i={...X,[e]:l};G(i),t.onFilterChange&&t.onFilterChange(i)},[X,t]);if(M){var eF,eA,ek,eN,eM,eS,eC;return ee?(0,i.jsx)(v.A,{isOpen:M,onClose:S||(()=>{}),title:t.title||"Chart View",subtitle:t.subtitle,children:(0,i.jsxs)("div",{className:"w-full h-[80vh] relative overflow-visible",children:[(0,i.jsx)("div",{className:"mb-4 flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(null==(eA=t.additionalOptions)||null==(eF=eA.filters)?void 0:eF.timeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(b.A,{value:(null==X?void 0:X.timeFilter)||t.additionalOptions.filters.timeFilter.activeValue||"M",onChange:e=>ew("timeFilter",e),options:null==(ek=t.additionalOptions.filters.timeFilter.options)?void 0:ek.map(e=>({value:e,label:e}))})}),(null==(eM=t.additionalOptions)||null==(eN=eM.filters)?void 0:eN.currencyFilter)&&(0,i.jsx)(y.A,{currency:(null==X?void 0:X.currencyFilter)||t.additionalOptions.filters.currencyFilter.activeValue||"USD",onChange:e=>ew("currencyFilter",e),options:t.additionalOptions.filters.currencyFilter.options}),(null==(eC=t.additionalOptions)||null==(eS=eC.filters)?void 0:eS.displayModeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(j.A,{mode:(null==X?void 0:X.displayMode)||t.additionalOptions.filters.displayModeFilter.activeValue||"absolute",onChange:e=>ew("displayMode",e)})})]})}),(0,i.jsx)("div",{className:"w-full h-px bg-gray-900 mb-4"}),(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsx)("div",{className:"w-[90%] h-[90%] pr-3 border-r border-gray-900",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[Z.visible&&Z.items&&(0,i.jsx)("div",{className:"absolute z-50",style:{pointerEvents:"none",top:Z.top,left:Z.left},children:(0,i.jsx)(g.A,{title:String(Z.key),items:Z.items,left:0,top:0,isModal:!0,timeFilter:(null==X?void 0:X.timeFilter)||(null==D?void 0:D.timeFilter),currencyFilter:(null==X?void 0:X.currencyFilter)||(null==D?void 0:D.currencyFilter)})}),(0,i.jsx)("div",{className:"h-[85%] w-full relative",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ey(t,l,!0):null}})}),ep.length>0?ej(!0):(0,i.jsx)("div",{className:"h-[15%] w-full flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})}),(0,i.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:(0,i.jsx)("div",{className:"space-y-2 w-full overflow-y-auto max-h-[600px] [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:V.map(e=>(0,i.jsx)(p.A,{label:e.label,color:e.color,shape:"square",tooltipText:e.value?ec(e.value):void 0},e.id))})})]})]})}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:"Loading expanded view..."})}return(0,i.jsxs)("div",{className:"w-full h-full relative",children:[(0,i.jsx)("div",{className:"h-[85%] w-full",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ey(t,l):null}})}),ep.length>0?ej(!1):(0,i.jsx)("div",{className:"h-[15%] w-full mt-2 flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})});var N=l(78398);let M=e=>{let{className:t="w-4 h-4"}=e;return(0,i.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},S=r.memo(e=>{let{chartConfig:t,data:l,width:w=500,height:F=300,isExpanded:A=!1,onCloseExpanded:k,colorMap:S,filterValues:C,yAxisUnit:D}=e,O=(0,r.useRef)(null),E=(0,r.useRef)(null),[L,T]=(0,r.useState)(null),[z,V]=(0,r.useState)([]),[B,R]=(0,r.useState)(!1),[W,$]=(0,r.useState)(null),[U,P]=(0,r.useState)([]),[_,q]=(0,r.useState)([]),[Y,Z]=(0,r.useState)({visible:!1,left:0,top:0,key:"",items:[]}),[Q,I]=(0,r.useState)(!1),[K,H]=(0,r.useState)(null),[J,X]=(0,r.useState)(C||{}),[G,ee]=(0,r.useState)(!1),[et,el]=(0,r.useState)("absolute"),ei=t.dataMapping.xAxis,er=t.dataMapping.yAxis,ea=t.dataMapping.groupBy||"",en="string"==typeof ei?ei:ei[0],es=(0,r.useCallback)(e=>"string"==typeof e?e:e.field,[]),eo=(0,r.useMemo)(()=>"string"==typeof er?er:Array.isArray(er)&&er.length>0?es(er[0]):"",[er,es]),ec=(0,r.useMemo)(()=>"string"==typeof er?[er]:Array.isArray(er)?er.map(e=>es(e)):[],[er,es]);(0,r.useEffect)(()=>{ee(!0)},[]);let ed=(0,r.useCallback)((e,t)=>{let l;if(null==e)return"0.00";if("percent"===et)return"".concat(e.toFixed(1),"%");let i=t||D||"",r=i&&"%"!==i&&"SOL"!==i;return(l=e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e.toFixed(2),i)?r?"".concat(i).concat(l):"".concat(l,"\xa0").concat(i):l},[D,et]),eu=(0,r.useCallback)(e=>{if("percent"===et)return"".concat(e.toFixed(0),"%");if(0===e)return"0";if(e>=1e9){let t=(e/1e9).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"B"):"".concat(t,"B")}if(e>=1e6){let t=(e/1e6).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"M"):"".concat(t,"M")}if(!(e>=1e3))return e.toFixed(0);{let t=(e/1e3).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"K"):"".concat(t,"K")}},[et]);(0,r.useEffect)(()=>{C&&(X(C),C.displayMode&&el(C.displayMode))},[C]);let eh=(0,r.useCallback)((e,l)=>{console.log("Modal filter changed: ".concat(e," = ").concat(l)),"displayMode"===e&&el(l);let i={...J,[e]:l};X(i),t.onFilterChange&&t.onFilterChange(i)},[J,t]),ef=(0,r.useCallback)((e,l)=>{if(A)return eh(e,l);console.log("Filter changed: ".concat(e," = ").concat(l)),"displayMode"===e&&el(l);let i={...J,[e]:l};X(i),t.onFilterChange&&t.onFilterChange(i)},[J,t,A,eh]),eg=(0,r.useCallback)(()=>{t.onFilterChange&&t.onFilterChange(C||{}),T(null)},[C,t]),{chartData:em,keys:ep,groupColors:ex}=(0,r.useMemo)(()=>{let e=A&&Q&&_.length>0?_:!A&&B&&U.length>0?U:l;if(A&&console.log("Modal chart data source:",Q&&_.length>0?"modal filtered data":"full data","Count:",e.length),!e||0===e.length)return{chartData:[],keys:[],groupColors:{}};let i=S||{},r=e.filter(e=>void 0!==e[en]&&null!==e[en]);if(r.length>0&&"string"==typeof r[0][en]&&(r[0][en].match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{4}$/.test(r[0][en])||/^\d{4}$/.test(r[0][en]))&&r.sort((e,t)=>{let l=new Date(e[en]),i=new Date(t[en]);return l.getTime()-i.getTime()}),Array.isArray(er)&&er.length>1&&t.isStacked){console.log("Processing multi-y-field stacked chart");let e=Array.isArray(er)?er.map(e=>"string"==typeof e?e:e.field):[eo],t={};r.forEach(l=>{let i=String(l[en]);t[i]||(t[i]={[en]:l[en]},e.forEach(e=>{t[i][e]=0})),e.forEach(e=>{if(void 0!==l[e]&&null!==l[e]){let r=Number(l[e])||0;t[i][e]=(t[i][e]||0)+r}})}),"percent"===et&&Object.keys(t).forEach(l=>{let i=e.reduce((e,i)=>e+(t[l][i]||0),0);i>0&&e.forEach(e=>{t[l][e]=t[l][e]/i*100})});let l={};return e.forEach((e,t)=>{l[e]=i[e]||(0,f.Vy)(t%f.h8.length)}),{chartData:Object.values(t),keys:e,groupColors:l}}let a={},n={},s=new Set;r.forEach(e=>{let t=String(e[en]),l=String(e[ea]);s.add(l),a[t]||(a[t]={[en]:e[en]},n[t]={});let i=Number(e[eo])||0;n[t][l]=(n[t][l]||0)+i}),Object.keys(a).forEach(e=>{s.forEach(t=>{a[e][t]=n[e][t]||0})}),"percent"===et&&Object.keys(a).forEach(e=>{let t=Array.from(s).reduce((t,l)=>t+(a[e][l]||0),0);t>0&&s.forEach(l=>{a[e][l]=a[e][l]/t*100})});let o=Object.values(a),c=Array.from(s);console.log("Found ".concat(c.length," groups for stacking:"),c);let d={};return c.forEach((e,t)=>{d[e]=i[e]||(0,f.Vy)(t%f.h8.length)}),{chartData:o,keys:c,groupColors:d}},[l,U,_,B,Q,en,eo,er,ea,S,A,t,et]),ev=(0,r.useCallback)(function(e){var i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null==(i=(r?E:O).current)?void 0:i.getBoundingClientRect();if(!a)return;let n=e.clientX-a.left,s=e.clientY-a.top;if(0===(r?Q&&_.length>0?_:l:B&&U.length>0?U:l).length||!ep||0===ep.length)return;let o={right:15,left:40},c=a.width-o.left-o.right,d=n-o.left;if(d<0||d>c){Y.visible&&Z(e=>({...e,visible:!1}));return}let u=Math.floor(d/(c/em.length));if(u<0||u>=em.length){Y.visible&&Z(e=>({...e,visible:!1}));return}let h=em[u];if(!h){Y.visible&&Z(e=>({...e,visible:!1}));return}let g=h[en],m=Math.max(s-10,10);if(Y.visible&&Y.key===g)Z(e=>({...e,left:n,top:m}));else{Array.isArray(er)&&er.length>1&&t.isStacked;let e=ep.filter(e=>Number(h[e])>0).map(e=>({label:e,value:ed(Number(h[e])||0),color:ex[e]||f.z1,shape:"square"}));e.sort((e,t)=>{let l="number"==typeof e.value?e.value:Number(String(e.value).replace(/[^0-9.-]+/g,""));return("number"==typeof t.value?t.value:Number(String(t.value).replace(/[^0-9.-]+/g,"")))-l}),Z({visible:!0,key:g,items:e,left:n,top:m})}},[l,U,_,B,Q,en,er,t,ep,ex,em,ed,Y.visible,Y.key,Y.items]),eb=(0,r.useCallback)(()=>{Y.visible&&Z(e=>({...e,visible:!1}))},[Y.visible]),ey=e=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==C?void 0:C.timeFilter)==="D"||(null==C?void 0:C.timeFilter)==="W");else if((null==C?void 0:C.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==C?void 0:C.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==C?void 0:C.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return/^Q[1-4]\s\d{4}$/.test(e)?e.substring(0,2):/^[A-Za-z]{3}\s\d{4}$/.test(e)?e.substring(0,3):e.length<=5?e:"".concat(e.substring(0,3),"...")},ej=(0,r.useCallback)(function(e,t){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(L||0===em.length||!ep||0===ep.length)return(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,i.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:L||"No data available"}),(0,i.jsx)(m.A,{onClick:eg,children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(M,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:"Refresh"})]})})]});let r={top:10,right:15,bottom:30,left:40},a=e-r.left-r.right,p=t-r.top-r.bottom;if(a<=0||p<=0)return null;let x=(0,o.A)({domain:em.map(e=>e[en]),range:[0,a],padding:.2}),v=Math.max(...em.map(e=>ep.reduce((t,l)=>t+(Number(e[l])||0),0)),1),b=(0,c.A)({domain:[0,"percent"===et?100:1.1*v],range:[p,0],nice:!0,clamp:!0});(0,N.A)({domain:ep,range:ep.map(e=>ex[e]||f.z1)});let y=(()=>{if(em.length>0&&"string"==typeof em[0][en]&&(/^\d{4}-\d{2}-\d{2}/.test(em[0][en])||/^\d{2}\/\d{2}\/\d{4}/.test(em[0][en])||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(em[0][en])||/^[A-Za-z]{3}\s\d{4}$/.test(em[0][en])||/^\d{4}$/.test(em[0][en]))&&em.length>8){let e=Math.ceil(em.length/8);return em.filter((t,l)=>l%e==0).map(e=>e[en])}return em.map(e=>e[en])})();return(0,i.jsxs)("div",{className:"relative w-full h-full",onMouseMove:e=>ev(e,l),onMouseLeave:eb,ref:l?E:O,children:[Y.visible&&Y.items&&!l&&(0,i.jsx)(g.A,{title:String(Y.key),items:Y.items,left:Y.left,top:Y.top,isModal:!1,timeFilter:null==C?void 0:C.timeFilter,currencyFilter:null==C?void 0:C.currencyFilter}),(0,i.jsx)("svg",{width:e,height:t,children:(0,i.jsxs)(n.A,{left:r.left,top:r.top,children:[(0,i.jsx)(s.A,{scale:b,width:a,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),(0,i.jsx)(d.A,{top:p,scale:x,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickValues:y,tickFormat:e=>{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==C?void 0:C.timeFilter)==="D"||(null==C?void 0:C.timeFilter)==="W");else if((null==C?void 0:C.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==C?void 0:C.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==C?void 0:C.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return ey(e)}return ey(String(e))},tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),left:0}),(0,i.jsx)(u.A,{scale:b,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!1,numTicks:5,tickFormat:e=>eu(Number(e)),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.25em"})}),em.map((e,t)=>{let l=x(e[en])||0,r=p,a=[];return ep.filter(t=>Number(e[t])>0).sort((t,l)=>Number(e[t])-Number(e[l])).forEach(n=>{let s=p-b(Number(e[n])||0);r-=s,a.push((0,i.jsx)(h.A,{x:l,y:r,width:x.bandwidth(),height:s,fill:ex[n],opacity:Y.visible&&Y.key===e[en]?1:.8,rx:2},"bar-".concat(t,"-").concat(n)))}),(0,i.jsx)(n.A,{children:a},"stack-".concat(t))})]})})]})},[em,ep,en,L,eu,ev,eb,ex,eg,Y.visible,Y.key,Y.items]);(0,r.useEffect)(()=>{em.length>0&&ep.length>0&&V(ep.map(e=>({id:e,label:e,color:ex[e]||f.z1})))},[em,ep,ex]);let ew=(0,r.useMemo)(()=>{if(!l||0===l.length)return[];console.log("Creating brush data with",l.length,"items");let e=[...l].filter(e=>void 0!==e[en]&&null!==e[en]);e.length>0&&"string"==typeof e[0][en]&&(e[0][en].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[0][en])||/^[A-Za-z]{3}\s\d{4}$/.test(e[0][en])||/^\d{4}$/.test(e[0][en]))&&e.sort((e,t)=>{let l=new Date(e[en]),i=new Date(t[en]);return l.getTime()-i.getTime()});let i=Array.isArray(er)&&er.length>1&&t.isStacked,r={};e.forEach(e=>{let t=String(e[en]);r[t]||(r[t]={...e,[en]:e[en],totalValue:0}),i?ec.forEach(l=>{if(void 0!==e[l]&&null!==e[l]){let i=Number(e[l])||0;r[t].totalValue+=i}}):r[t].totalValue+=Number(e[eo])||0});let a=Object.values(r);console.log("Processed ".concat(e.length," brush items into ").concat(a.length," unique data points"));let n=new Date;n.setHours(0,0,0,0);let s=a.map((e,t)=>{let l;return"string"==typeof e[en]&&(e[en].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[en])||/^[A-Za-z]{3}\s\d{4}$/.test(e[en])||/^\d{4}$/.test(e[en]))?isNaN((l=new Date(e[en])).getTime())&&(l=new Date(n)).setDate(n.getDate()+t):e[en]instanceof Date?l=e[en]:(l=new Date(n)).setDate(n.getDate()+t),{date:l,value:e.totalValue||0,idx:t,originalIndex:t,originalData:e}});return console.log("Created brush data points for stacked chart:",s.length),s},[l,en,eo,er,ec,t]),eF=(0,r.useCallback)(e=>{if(!e){B&&($(null),R(!1),P([]));return}let{x0:t,x1:i}=e;console.log("Brush change:",new Date(t),"to",new Date(i)),$([new Date(t),new Date(i)]);let r=ew.filter(e=>e.date>=new Date(t)&&e.date<=new Date(i));console.log("Selected brush items:",r.length);let a=r.map(e=>e.originalData[en]),n=l.filter(e=>a.includes(e[en]));console.log("Filtered data after brush:",n.length),P(n),B||R(!0)},[B,ew,l,en]),eA=(0,r.useCallback)(e=>{if(!e){Q&&(H(null),I(!1),q([]));return}let{x0:t,x1:i}=e;console.log("Modal brush change:",new Date(t),"to",new Date(i)),H([new Date(t),new Date(i)]);let r=ew.filter(e=>e.date>=new Date(t)&&e.date<=new Date(i));console.log("Selected modal brush items:",r.length);let a=r.map(e=>e.originalData[en]),n=l.filter(e=>a.includes(e[en]));console.log("Filtered data after modal brush:",n.length),q(n),Q||I(!0)},[Q,ew,l,en]);(0,r.useEffect)(()=>{A&&(console.log("Modal opened, syncing brush domains"),H(W),I(B),B&&U.length>0&&(console.log("Syncing filtered data to modal:",U.length,"items"),q(U)))},[A,W,B,U]);let ek=(0,r.useMemo)(()=>em&&0!==em.length?Math.max(...em.map(e=>ep.reduce((t,l)=>t+(Number(e[l])||0),0)),1):1,[em,ep]),eN=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ew&&0!==ew.length?(0,i.jsx)("div",{className:"h-[18%] w-full mt-2",children:(0,i.jsx)(x.A,{data:ew,activeBrushDomain:e?K:W,onBrushChange:e?eA:eF,onClearBrush:()=>{e?(H(null),I(!1),q([])):($(null),R(!1),P([]))},getDate:e=>e.date,getValue:e=>Math.max(e.value||0,.05*ek),lineColor:"#3b82f6",margin:{top:10,right:14.5,bottom:e?10:20,left:39.5},isModal:e,curveType:"catmullRom",strokeWidth:2,filterValues:e?J:C})}):null},[ew,K,W,eA,eF,H,I,q,$,R,P,ek,J,C]);if(A){var eM,eS,eC,eD,eO;return G?(0,i.jsx)(v.A,{isOpen:A,onClose:k||(()=>{}),title:t.title||"Chart View",subtitle:t.subtitle,children:(0,i.jsxs)("div",{className:"w-full h-[80vh] relative overflow-visible",children:[(0,i.jsx)("div",{className:"mb-4 flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(null==(eS=t.additionalOptions)||null==(eM=eS.filters)?void 0:eM.timeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(b.A,{value:(null==J?void 0:J.timeFilter)||t.additionalOptions.filters.timeFilter.activeValue||"M",onChange:e=>ef("timeFilter",e),options:null==(eC=t.additionalOptions.filters.timeFilter.options)?void 0:eC.map(e=>({value:e,label:e}))})}),(null==(eO=t.additionalOptions)||null==(eD=eO.filters)?void 0:eD.currencyFilter)&&(0,i.jsx)(y.A,{currency:(null==J?void 0:J.currencyFilter)||t.additionalOptions.filters.currencyFilter.activeValue||"USD",onChange:e=>ef("currencyFilter",e),options:t.additionalOptions.filters.currencyFilter.options}),(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(j.A,{mode:et,onChange:e=>ef("displayMode",e)})})]})}),(0,i.jsx)("div",{className:"w-full h-px bg-gray-900 mb-4"}),(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsx)("div",{className:"w-[90%] h-[90%] pr-3 border-r border-gray-900",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[Y.visible&&Y.items&&(0,i.jsx)("div",{className:"absolute z-50",style:{pointerEvents:"none",top:Y.top,left:Y.left},children:(0,i.jsx)(g.A,{title:String(Y.key),items:Y.items,left:0,top:0,isModal:!0,timeFilter:(null==J?void 0:J.timeFilter)||(null==C?void 0:C.timeFilter),currencyFilter:(null==J?void 0:J.currencyFilter)||(null==C?void 0:C.currencyFilter)})}),(0,i.jsx)("div",{className:"h-[85%] w-full relative",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ej(t,l,!0):null}})}),ew.length>0?eN(!0):(0,i.jsx)("div",{className:"h-[15%] w-full flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})}),(0,i.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:(0,i.jsx)("div",{className:"space-y-2 w-full overflow-y-auto max-h-[600px] [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:z.map(e=>(0,i.jsx)(p.A,{label:e.label,color:e.color,shape:"square"},e.id))})})]})]})}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:"Loading expanded view..."})}return(0,i.jsxs)("div",{className:"w-full h-full relative",children:[(0,i.jsx)("div",{className:"h-[85%] w-full",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ej(t,l):null}})}),ew.length>0?eN(!1):(0,i.jsx)("div",{className:"h-[15%] w-full mt-2 flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})});var C=l(74537),D=l(13600),O=l(38108);let E=e=>{let{className:t="w-4 h-4"}=e;return(0,i.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})};function L(e){return"string"==typeof e?e:e.field}function T(e){return"string"==typeof e?void 0:e.unit}function z(e,t,l){let i,r=t||l||"",a=r&&"%"!==r&&"SOL"!==r;return(i=e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e.toFixed(2),r)?a?"".concat(r).concat(i):"".concat(i,"\xa0").concat(r):i}let V=r.memo(e=>{let{chartConfig:t,data:l,width:w=500,height:F=300,isExpanded:A=!1,onCloseExpanded:k,colorMap:N,filterValues:M,yAxisUnit:S}=e,V=(0,r.useRef)(null),B=(0,r.useRef)(null),[R,W]=(0,r.useState)(null),[$,U]=(0,r.useState)([]),[P,_]=(0,r.useState)(!1),[q,Y]=(0,r.useState)(null),[Z,Q]=(0,r.useState)([]),[I,K]=(0,r.useState)([]),[H,J]=(0,r.useState)({visible:!1,left:0,top:0,key:"",items:[]}),[X,G]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(null),[el,ei]=(0,r.useState)(M||{}),[er,ea]=(0,r.useState)(!1),en=t.dataMapping.xAxis,es=t.dataMapping.yAxis,eo="string"==typeof en?en:en[0];(0,r.useEffect)(()=>{ea(!0)},[]);let ec=(0,r.useCallback)(e=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==M?void 0:M.timeFilter)==="D"||(null==M?void 0:M.timeFilter)==="W");else if((null==M?void 0:M.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==M?void 0:M.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==M?void 0:M.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return/^Q[1-4]\s\d{4}$/.test(e)?e.substring(0,2):/^[A-Za-z]{3}\s\d{4}$/.test(e)?e.substring(0,3):e.length<=5?e:"".concat(e.substring(0,3),"...")},[M]),ed=(0,r.useCallback)(e=>null==e?"$0.00":e>=1e9?"$".concat((e/1e9).toFixed(2),"B"):e>=1e6?"$".concat((e/1e6).toFixed(2),"M"):e>=1e3?"$".concat((e/1e3).toFixed(2),"K"):"$".concat(e.toFixed(2)),[]),eu=(0,r.useCallback)(e=>{if(0===e)return"0";if(e>=1e9){let t=(e/1e9).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"B"):"".concat(t,"B")}if(e>=1e6){let t=(e/1e6).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"M"):"".concat(t,"M")}if(!(e>=1e3))return e.toFixed(0);{let t=(e/1e3).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"K"):"".concat(t,"K")}},[]),eh=(0,r.useCallback)(()=>{t.onFilterChange&&t.onFilterChange(M||{}),W(null)},[M,t]),{chartData:ef,fields:eg,fieldColors:em}=(0,r.useMemo)(()=>{let e=A&&X&&I.length>0?I:!A&&P&&Z.length>0?Z:l;if(!e||0===e.length)return{chartData:[],fields:[],fieldColors:{}};let t=N||{},i=e.filter(e=>void 0!==e[eo]&&null!==e[eo]);i.length>0&&"string"==typeof i[0][eo]&&(i[0][eo].match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{4}$/.test(i[0][eo])||/^\d{4}$/.test(i[0][eo]))&&i.sort((e,t)=>{let l=new Date(e[eo]),i=new Date(t[eo]);return l.getTime()-i.getTime()});let r=[];r=Array.isArray(es)?es.map(e=>L(e)):[L(es)];let a={};return r.forEach((e,l)=>{a[e]=t[e]||(0,f.Vy)(l)}),{chartData:i,fields:r,fieldColors:a}},[l,Z,I,P,X,eo,es,N,A]),ep=(0,r.useCallback)(e=>!!t.dualAxisConfig&&t.dualAxisConfig.rightAxisFields.includes(e),[t.dualAxisConfig]),ex=(0,r.useCallback)(e=>{if(!t.dualAxisConfig)return!1;if(Array.isArray(es)&&"string"!=typeof es[0]){let t=es.find(t=>t.field===e);if(t)return"line"===t.type}return ep(e)?"line"===t.dualAxisConfig.rightAxisType:"line"===t.dualAxisConfig.leftAxisType},[t.dualAxisConfig,es,ep]),ev=(0,r.useCallback)(function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null==(t=(i?B:V).current)?void 0:t.getBoundingClientRect();if(!r)return;let a=e.clientX-r.left,n=e.clientY-r.top;if(0===(i?X&&I.length>0?I:l:P&&Z.length>0?Z:l).length)return;let s={right:25,left:40},o=r.width-s.left-s.right,c=a-s.left;if(c<0||c>o){H.visible&&J(e=>({...e,visible:!1}));return}let d=Math.floor(c/(o/ef.length));if(d<0||d>=ef.length){H.visible&&J(e=>({...e,visible:!1}));return}let u=ef[d];if(!u){H.visible&&J(e=>({...e,visible:!1}));return}let h=u[eo],g=Math.max(n-10,10);if(H.visible&&H.key===h)J(e=>({...e,left:a,top:g}));else{let e=eg.filter(e=>{let t=Number(u[e]);return!isNaN(t)&&t>0}).map(e=>{let t=T(Array.isArray(es)&&es.find(t=>L(t)===e)||e);return{label:e,value:z(Number(u[e])||0,t),color:em[e]||f.z1,shape:ex(e)?"circle":"square"}});if(0===e.length&&eg.length>0){let t=T(Array.isArray(es)&&es.find(e=>L(e)===eg[0])||eg[0]);e.push({label:eg[0],value:z(0,t),color:em[eg[0]]||f.z1,shape:ex(eg[0])?"circle":"square"})}J({visible:!0,key:h,items:e,left:a,top:g})}},[l,Z,I,P,X,ef,eg,eo,es,em,ed,H.visible,H.key,H.items,ex,T]),eb=(0,r.useCallback)(()=>{H.visible&&J(e=>({...e,visible:!1}))},[H.visible]),ey=(0,r.useMemo)(()=>{if(!l||0===l.length)return[];let e=l.filter(e=>void 0!==e[eo]&&null!==e[eo]),t=new Date;t.setHours(0,0,0,0);let i=eg.length>0?eg[0]:"";return e.map((e,l)=>{let r;return"string"==typeof e[eo]&&(e[eo].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[eo])||/^[A-Za-z]{3}\s\d{4}$/.test(e[eo])||/^\d{4}$/.test(e[eo]))?isNaN((r=new Date(e[eo])).getTime())&&(r=new Date(t)).setDate(t.getDate()+l):(r=new Date(t)).setDate(t.getDate()+l),{date:r,value:Number(e[i])||0,originalData:e}}).sort((e,t)=>e.date.getTime()-t.date.getTime())},[l,eo,eg]),ej=(0,r.useCallback)(e=>{if(!e){P&&(Y(null),_(!1),Q([]));return}let{x0:t,x1:l}=e;Y([new Date(t),new Date(l)]),Q(ey.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l)).map(e=>e.originalData)),P||_(!0)},[P,ey]),ew=(0,r.useCallback)(e=>{if(!e){X&&(et(null),G(!1),K([]));return}let{x0:t,x1:l}=e;et([new Date(t),new Date(l)]),K(ey.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l)).map(e=>e.originalData)),X||G(!0)},[X,ey]),eF=(0,r.useCallback)((e,l)=>{console.log("Modal filter changed: ".concat(e," = ").concat(l));let i={...el,[e]:l};ei(i),t.onFilterChange&&t.onFilterChange(i)},[el,t]),eA=(0,r.useCallback)(()=>{eg.length>0&&U(eg.map(e=>({id:e,label:e,color:em[e]||f.z1})))},[eg,em]);(0,r.useEffect)(()=>{A&&(console.log("Modal opened, syncing brush domains"),et(q),G(P),P&&Z.length>0?(console.log("Syncing filtered data to modal:",Z.length,"items"),K(Z)):K(l),eA())},[A,q,P,Z,l,eA]);let ek=(0,r.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(R||0===ef.length)return(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,i.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:R||"No data available"}),(0,i.jsx)(m.A,{onClick:eh,children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(E,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:"Refresh"})]})})]});let f={top:10,right:25,bottom:30,left:40},p=e-f.left-f.right,x=t-f.top-f.bottom;if(p<=0||x<=0)return null;let v=a?X&&I.length>0?I:l:P&&Z.length>0?Z:l,b=(0,o.A)({domain:v.map(e=>e[eo]).sort((e,t)=>{if("string"==typeof e&&"string"==typeof t&&(e.match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{1,2}$/.test(e))&&(t.match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{1,2}$/.test(t))){let l=new Date(e),i=new Date(t);if(!isNaN(l.getTime())&&!isNaN(i.getTime()))return l.getTime()-i.getTime()}return 0}),range:[0,p],padding:.2}),y=eg.filter(e=>!ep(e)),j=eg.filter(e=>ep(e)),w=Math.max(...v.flatMap(e=>y.map(t=>Number(e[t])||0)),1),F=Math.max(...v.flatMap(e=>j.map(t=>Number(e[t])||0)),1),A=(0,c.A)({domain:[0,1.1*w],range:[x,0],nice:!0,clamp:!0}),k=(0,c.A)({domain:[0,1.1*F],range:[x,0],nice:!0,clamp:!0}),N={};eg.forEach(e=>{ex(e)&&(N[e]=[])}),v.forEach(e=>{eg.forEach(t=>{if(ex(t)){let l=(b(e[eo])||0)+b.bandwidth()/2,i=ep(t)?k(Number(e[t])||0):A(Number(e[t])||0);N[t].push({x:l,y:i})}})}),Object.keys(N).forEach(e=>{N[e].sort((e,t)=>e.x-t.x)});let S=(()=>{if(ef.length>0&&"string"==typeof ef[0][eo]&&(/^\d{4}-\d{2}-\d{2}/.test(ef[0][eo])||/^\d{2}\/\d{2}\/\d{4}/.test(ef[0][eo])||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(ef[0][eo])||/^[A-Za-z]{3}\s\d{4}$/.test(ef[0][eo])||/^\d{4}$/.test(ef[0][eo]))&&ef.length>8){let e=Math.ceil(ef.length/8);return ef.filter((t,l)=>l%e==0).map(e=>e[eo])}return ef.map(e=>e[eo])})();return(0,i.jsxs)("div",{className:"relative w-full h-full",onMouseMove:a?e=>ev(e,!0):e=>ev(e,!1),onMouseLeave:eb,ref:a?B:V,children:[H.visible&&H.items&&!a&&(0,i.jsx)(g.A,{title:String(H.key),items:H.items,left:H.left,top:H.top,isModal:!1,timeFilter:null==M?void 0:M.timeFilter,currencyFilter:null==M?void 0:M.currencyFilter}),(0,i.jsx)("svg",{width:e,height:t,children:(0,i.jsxs)(n.A,{left:f.left,top:f.top,children:[(0,i.jsx)(s.A,{scale:A,width:p,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),(0,i.jsx)(u.A,{scale:A,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!1,numTicks:5,tickFormat:e=>eu(Number(e)),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.25em"})}),(0,i.jsx)(C.A,{scale:k,left:p,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!1,numTicks:5,tickFormat:e=>eu(Number(e)),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"start",dy:"0.33em",dx:"0.25em"})}),(0,i.jsx)(d.A,{top:x,scale:b,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickValues:S,tickFormat:e=>{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==M?void 0:M.timeFilter)==="D"||(null==M?void 0:M.timeFilter)==="W");else if((null==M?void 0:M.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==M?void 0:M.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==M?void 0:M.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return ec(e)}return ec(String(e))},tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),left:0}),v.map((e,t)=>(0,i.jsx)(r.Fragment,{children:eg.map((l,r)=>{if(ex(l))return null;let a=eg.filter(e=>!ex(e)),n=b.bandwidth()/a.length,s=a.indexOf(l),o=Number(e[l])||0,c=x-(ep(l)?k:A)(o),d=(b(e[eo])||0)+s*n,u=x-c;return(0,i.jsx)(h.A,{x:d,y:u,width:n,height:c,fill:em[l],opacity:H.visible&&H.key===e[eo]?1:.8,rx:2},"bar-".concat(t,"-").concat(l))})},"bars-".concat(t))),eg.map(e=>{if(!ex(e))return null;let t=N[e];return t&&0!==t.length?(0,i.jsx)(D.A,{data:t,x:e=>e.x,y:e=>e.y,stroke:em[e],strokeWidth:2,curve:O.A},"line-".concat(e)):null})]})}),H.visible&&H.items&&a&&(0,i.jsx)("div",{className:"absolute z-50",style:{pointerEvents:"none",top:H.top,left:H.left},children:(0,i.jsx)(g.A,{title:String(H.key),items:H.items,left:0,top:0,isModal:!0,timeFilter:(null==el?void 0:el.timeFilter)||(null==M?void 0:M.timeFilter),currencyFilter:(null==el?void 0:el.currencyFilter)||(null==M?void 0:M.currencyFilter)})})]})},[ef,eg,eo,R,eh,ev,eb,H,em,ep,ex,eu,ec,P,X,Z,I,l,S,M,el]),eN=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ey&&0!==ey.length?(0,i.jsx)("div",{className:"h-[15%] w-full mt-2",children:(0,i.jsx)(x.A,{data:ey,activeBrushDomain:e?ee:q,onBrushChange:e?ew:ej,onClearBrush:()=>{e?(et(null),G(!1),K([])):(Y(null),_(!1),Q([]))},getDate:e=>e.date,getValue:e=>e.value,lineColor:"#60a5fa",margin:{top:0,right:25,bottom:20,left:30},isModal:e,curveType:"catmullRom",strokeWidth:1.5,filterValues:e?el:M})}):null},[ey,ee,q,ew,ej,el,M]);if(A){var eM,eS,eC,eD,eO,eE,eL;return er?(0,i.jsx)(v.A,{isOpen:A,onClose:k||(()=>{}),title:t.title||"Chart View",subtitle:t.subtitle,children:(0,i.jsxs)("div",{className:"w-full h-[80vh] relative overflow-visible",children:[(0,i.jsx)("div",{className:"mb-4 flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(null==(eS=t.additionalOptions)||null==(eM=eS.filters)?void 0:eM.timeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(b.A,{value:(null==el?void 0:el.timeFilter)||t.additionalOptions.filters.timeFilter.activeValue||"M",onChange:e=>eF("timeFilter",e),options:null==(eC=t.additionalOptions.filters.timeFilter.options)?void 0:eC.map(e=>({value:e,label:e}))})}),(null==(eO=t.additionalOptions)||null==(eD=eO.filters)?void 0:eD.currencyFilter)&&(0,i.jsx)(y.A,{currency:(null==el?void 0:el.currencyFilter)||t.additionalOptions.filters.currencyFilter.activeValue||"USD",onChange:e=>eF("currencyFilter",e),options:t.additionalOptions.filters.currencyFilter.options}),(null==(eL=t.additionalOptions)||null==(eE=eL.filters)?void 0:eE.displayModeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(j.A,{mode:(null==el?void 0:el.displayMode)||t.additionalOptions.filters.displayModeFilter.activeValue||"absolute",onChange:e=>eF("displayMode",e)})})]})}),(0,i.jsx)("div",{className:"w-full h-px bg-gray-900 mb-4"}),(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsx)("div",{className:"w-[90%] h-[90%] pr-3 border-r border-gray-900",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsx)("div",{className:"h-[85%] w-full relative",ref:B,children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ek(t,l,!0):null}})}),ey.length>0?eN(!0):(0,i.jsx)("div",{className:"h-[15%] w-full flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})}),(0,i.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:(0,i.jsx)("div",{className:"space-y-2 w-full overflow-y-auto max-h-[600px] [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:$.map(e=>(0,i.jsx)(p.A,{label:e.label,color:e.color,shape:ex(e.id)?"circle":"square"},e.id))})})]})]})}):(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:"Loading expanded view..."})}return(0,i.jsxs)("div",{className:"w-full h-full relative",children:[(0,i.jsx)("div",{className:"h-[85%] w-full",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?ek(t,l):null}})}),ey.length>0?eN(!1):(0,i.jsx)("div",{className:"h-[15%] w-full mt-2 flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})}),B=e=>{let{className:t="w-4 h-4"}=e;return(0,i.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})};function R(e){return"string"==typeof e?e:e.field}function W(e,t,l){let i,r=t||l||"",a=r&&"%"!==r&&"SOL"!==r;return(i=e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e.toFixed(2),r)?a?"".concat(r).concat(i):"".concat(i,"\xa0").concat(r):i}let $=(e,t)=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(e)){let l=new Date(e);if(!isNaN(l.getTime())){if("D"===t||"W"===t);else if("M"===t)return l.toLocaleDateString("en-US",{month:"short"});else if("Q"===t){let e=Math.floor(l.getMonth()/3)+1;return"Q".concat(e)}else if("Y"===t)return l.getFullYear().toString();return l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return/^Q[1-4]\s\d{4}$/.test(e)?e.substring(0,2):/^[A-Za-z]{3}\s\d{4}$/.test(e)?e.substring(0,3):e.length<=5?e:"".concat(e.substring(0,3),"...")},U=r.memo(e=>{var t,l,w,F,A,k,N;let{chartConfig:M,data:S,width:C=500,height:E=300,isExpanded:L=!1,onCloseExpanded:T,colorMap:z,filterValues:V,yAxisUnit:U}=e,P=(0,r.useRef)(null),_=(0,r.useRef)(null),[q,Y]=(0,r.useState)(null),[Z,Q]=(0,r.useState)([]),[I,K]=(0,r.useState)(!1),[H,J]=(0,r.useState)(null),[X,G]=(0,r.useState)([]),[ee,et]=(0,r.useState)([]),[el,ei]=(0,r.useState)(!1),[er,ea]=(0,r.useState)(null),[en,es]=(0,r.useState)(V||{}),[eo,ec]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)({visible:!1,left:0,top:0,key:"",items:[]}),eh=M.dataMapping.xAxis,ef=M.dataMapping.yAxis,eg="string"==typeof eh?eh:eh[0],em=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];setTimeout(()=>{let t=document;if(e){let e=document.querySelector(".modal-backdrop");if(!e)return;t=e,console.log("Modal container found for brush reset:",e)}let l=t.querySelectorAll(".visx-brush-selection");console.log("Found ".concat(l.length," brush elements in ").concat(e?"modal":"main"," view")),l.length>0&&(console.log("Forcing ".concat(e?"modal ":"","brush visual reset")),l.forEach(e=>{if(e instanceof SVGRectElement){let t=e.closest("svg");if(t){let l=t.querySelector(".visx-brush");if(l){let t=l.getBoundingClientRect().width;e.setAttribute("width",String(t-4)),e.setAttribute("x","2"),console.log("Reset brush to width: ".concat(t-4,", x: 2"))}}}})),e&&t.querySelectorAll("svg").forEach(e=>{let t=e.querySelectorAll(".visx-brush-selection");t.length>0&&(console.log("Found ".concat(t.length," brush elements in a specific SVG")),t.forEach(t=>{if(t instanceof SVGRectElement){let l=e.querySelector(".visx-brush");if(l){let e=l.getBoundingClientRect().width;t.setAttribute("width",String(e-4)),t.setAttribute("x","2"),console.log("Reset specific SVG brush to width: ".concat(e-4,", x: 2"))}}}))})},100)},[]);(0,r.useEffect)(()=>{V&&(es(V),el&&L&&(console.log("Filter changed in modal, resetting brush to show full dataset"),ea(null),ei(!0),et(S),em(!0)))},[V,el,L,S,em]),(0,r.useEffect)(()=>{L&&(console.log("Modal opened, syncing brush domains"),ea(H),ei(I),I&&X.length>0&&(console.log("Syncing filtered data to modal:",X.length,"items"),et(X)))},[L,H,I,X]),(0,r.useEffect)(()=>{console.log("filterValues changed directly from parent:",V),V&&(el&&L&&(console.log("Directly resetting brush due to external filter change"),ea(null),ei(!0),et(S),em(!0)),I&&(J(null),K(!0),G(S),em(!1)),es(V))},[JSON.stringify(V),el,I,L,S,em]);let ep=(0,r.useCallback)((e,t)=>{console.log("Modal filter changed: ".concat(e," = ").concat(t));let l={...en,[e]:t};es(l),M.onFilterChange&&M.onFilterChange(l)},[en,M]);(0,r.useCallback)(e=>W(e),[]);let ex=(0,r.useCallback)(e=>{if(0===e)return"0";if(e>=1e9){let t=(e/1e9).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"B"):"".concat(t,"B")}if(e>=1e6){let t=(e/1e6).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"M"):"".concat(t,"M")}if(!(e>=1e3))return e.toFixed(0);{let t=(e/1e3).toFixed(1);return t.endsWith(".0")?"".concat(t.slice(0,-2),"K"):"".concat(t,"K")}},[]),ev=(0,r.useCallback)(()=>{M.onFilterChange&&M.onFilterChange(V||{}),Y(null)},[V,M]),{chartData:eb,fields:ey,fieldColors:ej,fieldTypes:ew}=(0,r.useMemo)(()=>{let e=L?el&&ee.length>0?ee:S:I&&X.length>0?X:S;if(!e||0===e.length)return{chartData:[],fields:[],fieldColors:{},fieldTypes:{}};let t=z||{},l=e.filter(e=>void 0!==e[eg]&&null!==e[eg]);l.length>0&&"string"==typeof l[0][eg]&&(l[0][eg].match(/^\d{4}-\d{2}-\d{2}/)||/^\w+\s\d{4}$/.test(l[0][eg])||/^\d{4}$/.test(l[0][eg]))&&l.sort((e,t)=>{let l=new Date(e[eg]),i=new Date(t[eg]);return l.getTime()-i.getTime()});let i=[],r={};Array.isArray(ef)?(i=ef.map(e=>R(e)),ef.forEach(e=>{r[R(e)]="string"==typeof e?"bar":e.type})):(i=[R(ef)],r[R(ef)]="string"==typeof ef?"bar":ef.type);let a={};return i.forEach((e,l)=>{a[e]=t[e]||(0,f.Vy)(l)}),{chartData:l,fields:i,fieldColors:a,fieldTypes:r}},[S,X,I,eg,ef,z,L,el,ee]),eF=(0,r.useCallback)(()=>{ed.visible&&eu(e=>({...e,visible:!1}))},[ed.visible]),eA=(0,r.useCallback)(function(e){var t;let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null==(t=(l?_:P).current)?void 0:t.getBoundingClientRect();if(!i)return;let r=e.clientX-i.left,a=e.clientY-i.top,n={right:15,left:40},s=i.width-n.left-n.right,o=r-n.left;if(o<0||o>s){ed.visible&&eu(e=>({...e,visible:!1}));return}let c=Math.floor(o/(s/eb.length));if(c<0||c>=eb.length){ed.visible&&eu(e=>({...e,visible:!1}));return}let d=eb[c];if(!d){ed.visible&&eu(e=>({...e,visible:!1}));return}let u=d[eg],h=Math.max(a-10,10);if(ed.visible&&ed.key===u)eu(e=>({...e,left:r,top:h}));else{let e=ey.filter(e=>{let t=Number(d[e]);return!isNaN(t)&&t>0}).map(e=>{let t;if(Array.isArray(ef)){let l=ef.find(t=>("string"==typeof t?t:t.field)===e);t="string"==typeof l||null==l?void 0:l.unit}return{label:e,value:W(Number(d[e])||0,t),color:ej[e]||f.z1,shape:"line"===ew[e]?"circle":"square"}});if(0===e.length&&ey.length>0){let t;if(Array.isArray(ef)&&ey.length>0){let e=ef.find(e=>("string"==typeof e?e:e.field)===ey[0]);t="string"==typeof e||null==e?void 0:e.unit}e.push({label:ey[0],value:W(0,t),color:ej[ey[0]]||f.z1,shape:"line"===ew[ey[0]]?"circle":"square"})}eu({visible:!0,key:u,items:e,left:r,top:h})}},[eb,ey,eg,ej,ew,W,ed,ef]),ek=(0,r.useMemo)(()=>{if(!S||0===S.length)return[];let e=S.filter(e=>void 0!==e[eg]&&null!==e[eg]),t=new Date;t.setHours(0,0,0,0);let l=ey.length>0?ey[0]:"";return e.map((e,i)=>{let r;return"string"==typeof e[eg]&&(e[eg].match(/^\d{4}-\d{2}-\d{2}/)||/^\d{2}\/\d{2}\/\d{4}/.test(e[eg])||/^[A-Za-z]{3}\s\d{4}$/.test(e[eg])||/^\d{4}$/.test(e[eg]))?isNaN((r=new Date(e[eg])).getTime())&&(r=new Date(t)).setDate(t.getDate()+i):(r=new Date(t)).setDate(t.getDate()+i),{date:r,value:Number(e[l])||0,originalData:e}})},[S,eg,ey]),eN=(0,r.useCallback)(e=>{if(!e){I&&(J(null),G([]));return}let{x0:t,x1:l}=e;J([new Date(t),new Date(l)]),G(ek.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l)).map(e=>e.originalData)),I||K(!0)},[I,ek]),eM=(0,r.useCallback)(e=>{if(!e){el&&(ea(null),et([]));return}let{x0:t,x1:l}=e;ea([new Date(t),new Date(l)]),et(ek.filter(e=>e.date>=new Date(t)&&e.date<=new Date(l)).map(e=>e.originalData)),el||ei(!0)},[el,ek]);(0,r.useEffect)(()=>{eb.length>0&&ey.length>0&&Q(ey.map(e=>({id:e,label:e,color:ej[e]||f.z1})))},[eb,ey,ej]),(0,r.useEffect)(()=>{ec(!0)},[]);let eS=(0,r.useCallback)(function(e,t){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(q||0===eb.length)return(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,i.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:q||"No data available"}),(0,i.jsx)(m.A,{onClick:ev,children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(B,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:"Refresh"})]})})]});let a={top:10,right:15,bottom:30,left:40},f=e-a.left-a.right,p=t-a.top-a.bottom;if(f<=0||p<=0)return null;let x=(0,o.A)({domain:eb.map(e=>e[eg]),range:[0,f],padding:.2}),v=Math.max(...eb.flatMap(e=>ey.map(t=>Number(e[t])||0)),1),b=(0,c.A)({domain:[0,1.1*v],range:[p,0],nice:!0,clamp:!0}),y={};ey.forEach(e=>{"line"===ew[e]&&(y[e]=[])}),eb.forEach(e=>{ey.forEach(t=>{if("line"===ew[t]){let l=(x(e[eg])||0)+x.bandwidth()/2,i=b(Number(e[t])||0);y[t].push({x:l,y:i})}})}),Object.keys(y).forEach(e=>{y[e].sort((e,t)=>e.x-t.x)});let j=(()=>{if(eb.length>0&&"string"==typeof eb[0][eg]&&(/^\d{4}-\d{2}-\d{2}/.test(eb[0][eg])||/^\d{2}\/\d{2}\/\d{4}/.test(eb[0][eg])||/^\d{1,2}-[A-Za-z]{3}-\d{4}/.test(eb[0][eg])||/^[A-Za-z]{3}\s\d{4}$/.test(eb[0][eg])||/^\d{4}$/.test(eb[0][eg]))&&eb.length>8){let e=Math.ceil(eb.length/8);return eb.filter((t,l)=>l%e==0).map(e=>e[eg])}return eb.map(e=>e[eg])})();return(0,i.jsxs)("div",{className:"relative w-full h-full",onMouseMove:e=>eA(e,l),onMouseLeave:eF,ref:l?_:P,children:[ed.visible&&ed.items&&!l&&(0,i.jsx)(g.A,{title:String(ed.key),items:ed.items,left:ed.left,top:ed.top,isModal:!1,timeFilter:null==V?void 0:V.timeFilter,currencyFilter:null==V?void 0:V.currencyFilter}),(0,i.jsx)("svg",{width:e,height:t,children:(0,i.jsxs)(n.A,{left:a.left,top:a.top,children:[(0,i.jsx)(s.A,{scale:b,width:f,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),(0,i.jsx)(u.A,{scale:b,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!1,numTicks:5,tickFormat:e=>ex(Number(e)),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.25em"})}),(0,i.jsx)(d.A,{top:p,scale:x,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickValues:j,tickFormat:e=>{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e)){let t=new Date(e);if(!isNaN(t.getTime())){if((null==V?void 0:V.timeFilter)==="D"||(null==V?void 0:V.timeFilter)==="W");else if((null==V?void 0:V.timeFilter)==="M")return t.toLocaleDateString("en-US",{month:"short"});else if((null==V?void 0:V.timeFilter)==="Q"){let e=Math.floor(t.getMonth()/3)+1;return"Q".concat(e)}else if((null==V?void 0:V.timeFilter)==="Y")return t.getFullYear().toString();return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}return $(e,null==V?void 0:V.timeFilter)}return $(String(e),null==V?void 0:V.timeFilter)},tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),left:0}),eb.map((e,t)=>(0,i.jsx)(r.Fragment,{children:ey.map((l,r)=>{if("line"===ew[l])return null;let a=ey.filter(e=>"line"!==ew[e]),n=x.bandwidth()/a.length,s=a.indexOf(l),o=p-b(Number(e[l])||0),c=(x(e[eg])||0)+s*n,d=p-o;return(0,i.jsx)(h.A,{x:c,y:d,width:n,height:o,fill:ej[l],opacity:ed.visible&&ed.key===e[eg]?1:.8,rx:2},"bar-".concat(t,"-").concat(l))})},"bars-".concat(t))),ey.map(e=>{if("line"!==ew[e])return null;let t=y[e];return t&&0!==t.length?(0,i.jsx)(D.A,{data:t,x:e=>e.x,y:e=>e.y,stroke:ej[e],strokeWidth:2,curve:O.A},"line-".concat(e)):null})]})})]})},[eb,ey,eg,q,ev,eA,eF,ed,ej,ew,ex,_]),eC=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ek&&0!==ek.length?(0,i.jsx)("div",{className:"h-[15%] w-full mt-2",children:(0,i.jsx)(x.A,{data:ek,activeBrushDomain:e?er:H,onBrushChange:e?eM:eN,onClearBrush:()=>{e?(ea(null),ei(!0),et(S)):(J(null),K(!0),G(S))},getDate:e=>e.date,getValue:e=>e.value,lineColor:"#60a5fa",margin:{top:0,right:15,bottom:e?10:20,left:40},isModal:e,curveType:"catmullRom",strokeWidth:2,filterValues:e?en:V})}):null},[ek,er,H,eM,eN,ea,ei,et,J,K,G,S,en,V]);return(0,i.jsx)(i.Fragment,{children:L&&eo?(0,i.jsx)(v.A,{isOpen:L,onClose:T||(()=>{}),title:M.title||"Chart View",subtitle:M.subtitle,children:(0,i.jsxs)("div",{className:"w-full h-[80vh] relative overflow-visible",children:[(0,i.jsx)("div",{className:"mb-4 flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(null==(l=M.additionalOptions)||null==(t=l.filters)?void 0:t.timeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(b.A,{value:(null==en?void 0:en.timeFilter)||M.additionalOptions.filters.timeFilter.activeValue||"M",onChange:e=>ep("timeFilter",e),options:null==(w=M.additionalOptions.filters.timeFilter.options)?void 0:w.map(e=>({value:e,label:e}))})}),(null==(A=M.additionalOptions)||null==(F=A.filters)?void 0:F.currencyFilter)&&(0,i.jsx)(y.A,{currency:(null==en?void 0:en.currencyFilter)||M.additionalOptions.filters.currencyFilter.activeValue||"USD",onChange:e=>ep("currencyFilter",e),options:M.additionalOptions.filters.currencyFilter.options}),(null==(N=M.additionalOptions)||null==(k=N.filters)?void 0:k.displayModeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(j.A,{mode:(null==en?void 0:en.displayMode)||M.additionalOptions.filters.displayModeFilter.activeValue||"absolute",onChange:e=>ep("displayMode",e)})})]})}),(0,i.jsx)("div",{className:"w-full h-px bg-gray-900 mb-4"}),(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsx)("div",{className:"w-[90%] h-[90%] pr-3 border-r border-gray-900",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[ed.visible&&ed.items&&(0,i.jsx)("div",{className:"absolute z-50",style:{pointerEvents:"none",top:ed.top,left:ed.left},children:(0,i.jsx)(g.A,{title:String(ed.key),items:ed.items,left:0,top:0,isModal:!0,timeFilter:null==en?void 0:en.timeFilter,currencyFilter:(null==en?void 0:en.currencyFilter)||(null==V?void 0:V.currencyFilter)})}),(0,i.jsx)("div",{className:"h-[85%] w-full relative",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?eS(t,l,!0):null}})}),ek.length>0?eC(!0):(0,i.jsx)("div",{className:"h-[15%] w-full flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})}),(0,i.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:(0,i.jsx)("div",{className:"space-y-2 w-full overflow-y-auto max-h-[600px] [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:Z.map(e=>(0,i.jsx)(p.A,{label:e.label,color:e.color,shape:"line"===ew[e.id]?"circle":"square"},e.id))})})]})]})}):(0,i.jsxs)("div",{className:"w-full h-full relative",children:[(0,i.jsx)("div",{className:"h-[85%] w-full",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?eS(t,l):null}})}),ek.length>0?eC(!1):(0,i.jsx)("div",{className:"h-[15%] w-full flex items-center justify-center text-gray-500 text-sm",children:"No brush data available"})]})})});var P=l(41545);let _=e=>{let{className:t="w-4 h-4"}=e;return(0,i.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},q=r.memo(e=>{var t,l,s,o,c,d,u;let{chartConfig:h,data:x,width:w=500,height:F=300,isExpanded:A=!1,onCloseExpanded:k,colorMap:M,filterValues:S,yAxisUnit:C}=e,D=(0,r.useRef)(null),O=(0,r.useRef)(null),[E,L]=(0,r.useState)(null),[T,z]=(0,r.useState)([]),[V,B]=(0,r.useState)(!1),[R,W]=(0,r.useState)(S||{}),[$,U]=(0,r.useState)({visible:!1,left:0,top:0,data:null}),q=h.dataMapping.xAxis,Y=h.dataMapping.yAxis,Z="string"==typeof q?q:q[0],Q="string"==typeof Y?Y:Array.isArray(Y)?"string"==typeof Y[0]?Y[0]:Y[0].field:"",I="string"==typeof Y?C:Array.isArray(Y)&&Y.length>0&&"string"!=typeof Y[0]?Y[0].unit:C,K=(0,r.useCallback)((e,t)=>{let l;if(null==e)return"0.00";let i=t||"",r=i&&"%"!==i&&"SOL"!==i;return(l=e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e.toFixed(2),i)?r?"".concat(i).concat(l):"".concat(l,"\xa0").concat(i):l},[]),H=(0,r.useMemo)(()=>{if(!x||0===x.length||!Z||!Q)return[];let e=x.reduce((e,t)=>e+(Number(t[Q])||0),0);return x.map(t=>({label:String(t[Z]),value:Number(t[Q])||0,percentage:e>0?(Number(t[Q])||0)/e*100:0,originalData:t})).filter(e=>e.value>0).sort((e,t)=>t.value-e.value)},[x,Z,Q]),J=(0,r.useMemo)(()=>{let e=H.map(e=>e.label),t=e.map((e,t)=>(null==M?void 0:M[e])||(0,f.Vy)(t));return(0,N.A)({domain:e,range:t})},[H,M]),X=(0,r.useCallback)(()=>{h.onFilterChange&&h.onFilterChange(S||{}),L(null)},[S,h]),G=(0,r.useCallback)(()=>{$.visible&&U(e=>({...e,visible:!1}))},[$.visible]);(0,r.useEffect)(()=>{B(!0)},[]),(0,r.useEffect)(()=>{S&&W(S)},[S]),(0,r.useEffect)(()=>{H.length>0&&z(H.map(e=>({id:e.label,label:e.label,color:J(e.label),value:e.percentage})))},[H,J]);let ee=(0,r.useCallback)((e,t)=>{console.log("Modal filter changed: ".concat(e," = ").concat(t));let l={...R,[e]:t};W(l),h.onFilterChange&&h.onFilterChange(l)},[R,h]);(0,r.useCallback)((e,t)=>{if(A)return ee(e,t);console.log("Filter changed: ".concat(e," = ").concat(t));let l={...R,[e]:t};W(l),h.onFilterChange&&h.onFilterChange(l)},[R,h,A,ee]),(0,r.useCallback)((e,t)=>{let l=e.currentTarget.closest(".chart-container");if(!l)return;let i=l.getBoundingClientRect();U({visible:!0,data:t,left:e.clientX-i.left,top:e.clientY-i.top})},[]);let et=(0,r.useCallback)(function(e,t){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(E||0===H.length)return(0,i.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,i.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:E||"No data available"}),(0,i.jsx)(m.A,{onClick:X,children:(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(_,{className:"w-3.5 h-3.5"}),(0,i.jsx)("span",{children:"Refresh"})]})})]});let r={top:10,right:15,bottom:10,left:15},a=e-r.left-r.right,s=t-r.top-r.bottom;if(a<=0||s<=0)return null;let o=Math.min(a,s)/2.5;return(0,i.jsxs)("div",{className:"relative w-full h-full chart-container",onMouseLeave:G,ref:l?O:D,children:[$.visible&&$.data&&!l&&(0,i.jsx)(g.A,{title:$.data.label,items:[{label:"Value",value:K($.data.value,I),color:J($.data.label),shape:"square"},{label:"Percentage",value:"".concat($.data.percentage.toFixed(1),"%"),color:J($.data.label),shape:"square"}],left:$.left,top:$.top,isModal:!1,currencyFilter:null==S?void 0:S.currencyFilter}),(0,i.jsx)("svg",{width:e,height:t,children:(0,i.jsx)(n.A,{left:e/2,top:t/2,children:(0,i.jsx)(P.A,{data:H,pieValue:e=>e.value,outerRadius:o,innerRadius:.6*o,cornerRadius:3,padAngle:.005,children:e=>e.arcs.map((t,l)=>{let r=t.data,[a,n]=e.path.centroid(t),s=r.percentage>5,o=J(r.label);return(0,i.jsxs)("g",{onMouseMove:e=>{var t;let l=null==(t=e.currentTarget.closest("svg"))?void 0:t.getBoundingClientRect();if(l)U({visible:!0,data:r,left:e.clientX-l.left,top:e.clientY-l.top})},onMouseLeave:()=>U(e=>({...e,visible:!1})),children:[(0,i.jsx)("path",{d:e.path(t)||"",fill:o,stroke:"#000",strokeWidth:.5,strokeOpacity:.3}),s&&(0,i.jsx)("text",{fill:"white",x:a,y:n,dy:".33em",fontSize:11,textAnchor:"middle",pointerEvents:"none",children:"".concat(r.percentage.toFixed(0),"%")})]},"arc-".concat(r.label,"-").concat(l))})})})})]})},[H,E,X,G,$,J,K,I,S]);return(0,i.jsx)(i.Fragment,{children:A&&V?(0,i.jsx)(v.A,{isOpen:A,onClose:k||(()=>{}),title:h.title||"Pie Chart",subtitle:h.subtitle,children:(0,i.jsxs)("div",{className:"w-full h-[80vh] relative overflow-visible",children:[(0,i.jsx)("div",{className:"mb-4 flex justify-between items-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(null==(l=h.additionalOptions)||null==(t=l.filters)?void 0:t.timeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(b.A,{value:(null==R?void 0:R.timeFilter)||h.additionalOptions.filters.timeFilter.activeValue||"M",onChange:e=>ee("timeFilter",e),options:null==(s=h.additionalOptions.filters.timeFilter.options)?void 0:s.map(e=>({value:e,label:e}))})}),(null==(c=h.additionalOptions)||null==(o=c.filters)?void 0:o.currencyFilter)&&(0,i.jsx)(y.A,{currency:(null==R?void 0:R.currencyFilter)||h.additionalOptions.filters.currencyFilter.activeValue||"USD",onChange:e=>ee("currencyFilter",e),options:h.additionalOptions.filters.currencyFilter.options}),(null==(u=h.additionalOptions)||null==(d=u.filters)?void 0:d.displayModeFilter)&&(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(j.A,{mode:(null==R?void 0:R.displayMode)||h.additionalOptions.filters.displayModeFilter.activeValue||"absolute",onChange:e=>ee("displayMode",e)})})]})}),(0,i.jsx)("div",{className:"w-full h-px bg-gray-900 mb-4"}),(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsx)("div",{className:"w-[80%] h-[90%] pr-3 border-r border-gray-900",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[$.visible&&$.data&&(0,i.jsx)("div",{className:"absolute z-50",style:{pointerEvents:"none",top:$.top,left:$.left},children:(0,i.jsx)(g.A,{title:$.data.label,items:[{label:"Value",value:K($.data.value,I),color:J($.data.label),shape:"square"},{label:"Percentage",value:"".concat($.data.percentage.toFixed(1),"%"),color:J($.data.label),shape:"square"}],left:0,top:0,isModal:!0,currencyFilter:(null==R?void 0:R.currencyFilter)||(null==S?void 0:S.currencyFilter)})}),(0,i.jsx)("div",{className:"h-full w-full relative",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?et(t,l,!0):null}})})]})}),(0,i.jsx)("div",{className:"w-[20%] h-full pl-3 flex flex-col justify-start items-start",children:(0,i.jsx)("div",{className:"space-y-2 w-full overflow-y-auto max-h-[600px] [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:T.map(e=>{var t;return(0,i.jsx)(p.A,{label:"".concat(e.label," (").concat(null==(t=e.value)?void 0:t.toFixed(1),"%)"),color:e.color,shape:"square"},e.id)})})})]})]})}):(0,i.jsx)("div",{className:"w-full h-full relative",children:(0,i.jsx)(a.A,{debounceTime:10,children:e=>{let{width:t,height:l}=e;return t>0&&l>0?et(t,l):null}})})})});function Y(e){return"string"==typeof e?e:e.field}let Z=e=>{let{chartConfig:t,onDataLoaded:l,isExpanded:a=!1,onCloseExpanded:n,onFilterChange:s,filterValues:o,colorMap:c,onColorsGenerated:d,isLoading:u=!1}=e,[h,f]=(0,r.useState)([]),[g,m]=(0,r.useState)(null),[p,x]=(0,r.useState)({}),[w,F]=(0,r.useState)(!1),[A,N]=(0,r.useState)(c||{});(0,r.useEffect)(()=>{c&&N(c)},[c]),(0,r.useEffect)(()=>{d&&Object.keys(A).length>0&&JSON.stringify(c||{})!==JSON.stringify(A)&&d(A)},[A,d,c]);let M=o||p,C=(e,t)=>{if(t in e)return t;let l=t.toLowerCase(),i=Object.keys(e);for(let e of i)if(e.toLowerCase()===l)return e;let r=l.replace(/ /g,"_"),a=l.replace(/_/g," ");for(let e of i){let t=e.toLowerCase();if(t===r||t===a)return e}return null};(0,r.useEffect)(()=>{var e;if(o)return;let l={};(null==(e=t.additionalOptions)?void 0:e.filters)&&(t.additionalOptions.filters.timeFilter&&Array.isArray(t.additionalOptions.filters.timeFilter.options)&&t.additionalOptions.filters.timeFilter.options.length>0&&(l.timeFilter=t.additionalOptions.filters.timeFilter.options[0]),t.additionalOptions.filters.currencyFilter&&Array.isArray(t.additionalOptions.filters.currencyFilter.options)&&t.additionalOptions.filters.currencyFilter.options.length>0&&(l.currencyFilter=t.additionalOptions.filters.currencyFilter.options[0]),t.additionalOptions.filters.displayModeFilter&&Array.isArray(t.additionalOptions.filters.displayModeFilter.options)&&t.additionalOptions.filters.displayModeFilter.options.length>0&&(l.displayModeFilter=t.additionalOptions.filters.displayModeFilter.options[0])),x(l)},[t.id,o]);let D=(e,t)=>{console.log("Filter changed: ".concat(e," = ").concat(t)),s?s(e,t):(x(l=>({...l,[e]:t})),F(!0))},O=(e,t)=>e.includes("bar")?e.includes("stacked")&&t?[{platform:"Raydium",segment:"DEX",protocol_revenue:125e4},{platform:"Raydium",segment:"Lending",protocol_revenue:35e4},{platform:"Raydium",segment:"NFT",protocol_revenue:75e3},{platform:"Orca",segment:"DEX",protocol_revenue:98e4},{platform:"Orca",segment:"Lending",protocol_revenue:12e4},{platform:"Orca",segment:"Liquid Staking",protocol_revenue:42e4},{platform:"Drift",segment:"DEX",protocol_revenue:75e4},{platform:"Drift",segment:"Perpetuals",protocol_revenue:89e4},{platform:"Marinade",segment:"Liquid Staking",protocol_revenue:11e5},{platform:"Marinade",segment:"Lending",protocol_revenue:12e4}]:[{platform:"Raydium",protocol_revenue:175e4,volume:125e5,users:45e3},{platform:"Orca",protocol_revenue:138e4,volume:98e5,users:32e3},{platform:"Drift",protocol_revenue:164e4,volume:112e5,users:28e3},{platform:"Marinade",protocol_revenue:122e4,volume:54e5,users:56e3},{platform:"Jupiter",protocol_revenue:21e5,volume:186e5,users:78e3},{platform:"Solend",protocol_revenue:84e4,volume:42e5,users:22e3}]:"line"===e||e.includes("time")?[{date:"2023-01-01",protocol_revenue:98e4,cumulative_revenue:98e4},{date:"2023-02-01",protocol_revenue:125e4,cumulative_revenue:223e4},{date:"2023-03-01",protocol_revenue:142e4,cumulative_revenue:365e4},{date:"2023-04-01",protocol_revenue:165e4,cumulative_revenue:53e5},{date:"2023-05-01",protocol_revenue:21e5,cumulative_revenue:74e5},{date:"2023-06-01",protocol_revenue:185e4,cumulative_revenue:925e4}]:[{x:"A",y:100},{x:"B",y:200},{x:"C",y:150},{x:"D",y:300},{x:"E",y:250}];(0,r.useEffect)(()=>{let e=JSON.stringify({xAxis:t.dataMapping.xAxis,yAxis:t.dataMapping.yAxis,groupBy:t.dataMapping.groupBy}),i=new AbortController,r=i.signal,a=async()=>{m(null);let i=[];try{let o="".concat(t.apiEndpoint,"-").concat(e,"-").concat(JSON.stringify(M)),c=w?null:sessionStorage.getItem(o);if(c)console.log("Using cached data for",t.title),i=JSON.parse(c);else{var a,n,s;let e;try{e=new URL(t.apiEndpoint),t.apiKey&&e.searchParams.append("api_key",t.apiKey)}catch(e){throw Error("Invalid URL: ".concat(t.apiEndpoint))}let l={},c=null==(a=t.additionalOptions)?void 0:a.filters;void 0!==c&&(c.timeFilter&&M.timeFilter?(l[c.timeFilter.paramName]=M.timeFilter,console.log("Setting time filter: ".concat(c.timeFilter.paramName,"=").concat(M.timeFilter))):c.timeFilter&&Array.isArray(c.timeFilter.options)&&c.timeFilter.options.length>0&&(l[c.timeFilter.paramName]=c.timeFilter.options[0],console.log("Setting default time filter: ".concat(c.timeFilter.paramName,"=").concat(c.timeFilter.options[0]))),c.currencyFilter&&M.currencyFilter?(l[c.currencyFilter.paramName]=M.currencyFilter,console.log("Setting currency filter: ".concat(c.currencyFilter.paramName,"=").concat(M.currencyFilter))):c.currencyFilter&&Array.isArray(c.currencyFilter.options)&&c.currencyFilter.options.length>0&&(l[c.currencyFilter.paramName]=c.currencyFilter.options[0],console.log("Setting default currency filter: ".concat(c.currencyFilter.paramName,"=").concat(c.currencyFilter.options[0]))),c.displayModeFilter&&M.displayModeFilter?(l[c.displayModeFilter.paramName]=M.displayModeFilter,console.log("Setting display mode filter: ".concat(c.displayModeFilter.paramName,"=").concat(M.displayModeFilter))):c.displayModeFilter&&Array.isArray(c.displayModeFilter.options)&&c.displayModeFilter.options.length>0&&(l[c.displayModeFilter.paramName]=c.displayModeFilter.options[0],console.log("Setting default display mode filter: ".concat(c.displayModeFilter.paramName,"=").concat(c.displayModeFilter.options[0]))));let d=Object.keys(l).length>0,u={method:d?"POST":"GET",headers:{"Content-Type":"application/json"},cache:"no-store",signal:r,timeout:15e3};d&&(u.body=JSON.stringify({parameters:l}),console.log("Fetching data with request body:",u.body)),console.log("Fetching data from: ".concat(e.toString()," with method: ").concat(u.method));let h=await fetch(e.toString(),u);if(console.log("API response status: ".concat(h.status," ").concat(h.statusText)),!h.ok)throw Error("API request failed with status ".concat(h.status,": ").concat(h.statusText));let f=await h.json();if(console.log("API response structure:",Object.keys(f)),null==f||null==(s=f.query_result)||null==(n=s.data)?void 0:n.rows)i=f.query_result.data.rows,console.log("Found ".concat(i.length," rows in Redash format"));else if(Array.isArray(f))i=f,console.log("Found ".concat(i.length," rows in direct array format"));else if((null==f?void 0:f.data)&&Array.isArray(f.data))i=f.data,console.log("Found ".concat(i.length," rows in data array format"));else if((null==f?void 0:f.rows)&&Array.isArray(f.rows))i=f.rows,console.log("Found ".concat(i.length," rows in rows array format"));else if((null==f?void 0:f.results)&&Array.isArray(f.results))i=f.results,console.log("Found ".concat(i.length," rows in results array format"));else if(null==f?void 0:f.error)throw Error("API returned an error: ".concat(f.error));else throw console.error("Unrecognized API response structure:",f),Error("API response does not have a recognized structure");try{sessionStorage.setItem(o,JSON.stringify(i))}catch(e){console.warn("Failed to cache data:",e)}F(!1)}if(i.length>0&&!r.aborted){console.log("Chart data successfully loaded:",i.slice(0,2));try{let{xAxis:e,yAxis:a,groupBy:n}=t.dataMapping,s=i[0],o=Array.isArray(e)?e:[e],c=[];c=Array.isArray(a)?a.map(e=>Y(e)):[Y(a)];let d=!1,u=(e,t)=>!!C(e,t);for(let e of o){if(!u(s,e))throw Error('X-axis field "'.concat(e,'" not found in data. Available fields: ').concat(Object.keys(s).join(", ")));C(s,e)!==e&&(d=!0)}for(let e of c){if(!u(s,e))throw Error('Y-axis field "'.concat(e,'" not found in data. Available fields: ').concat(Object.keys(s).join(", ")));C(s,e)!==e&&(d=!0)}if(n&&(t.chartType.includes("stacked")||t.isStacked)){if(!u(s,n))throw Error('Group By field "'.concat(n,'" not found in data. Available fields: ').concat(Object.keys(s).join(", ")));C(s,n)!==n&&(d=!0)}d&&(i=i.map(e=>{let l={...e};for(let t of o){let i=C(e,t);i&&i!==t&&(l[t]=e[i])}for(let t of c){let i=C(e,t);i&&i!==t&&(l[t]=e[i])}if(n&&(t.chartType.includes("stacked")||t.isStacked)){let t=C(e,n);t&&t!==n&&(l[n]=e[t])}return l})),l&&!r.aborted&&l(i),r.aborted||f(i)}catch(e){r.aborted||(console.error("Error processing data:",e),m("Error processing data: ".concat(e instanceof Error?e.message:String(e))))}}}catch(e){if(!r.aborted){let l;console.error("Error fetching chart data:",e),e instanceof Error?e.message.includes("Failed to fetch")||e.message.includes("NetworkError")?l="Network error: Unable to reach the API. Check if the endpoint is accessible.":e.message.includes("CORS")?l="CORS error: The API doesn't allow requests from this origin.":(e.message.includes("API request failed with status"),l=e.message):l=String(e),i=O(t.chartType,t.dataMapping.groupBy),m("Using fallback data: ".concat(l)),console.log("Using fallback data:",i),r.aborted||f(i)}}};return t.apiEndpoint?a():m("No API endpoint provided"),()=>{i.abort()}},[t.apiEndpoint,t.apiKey,t.title,JSON.stringify(t.dataMapping),M,w]);let E=r.useCallback(()=>{console.log("Rendering chart with config:",{chartType:t.chartType,isStacked:t.isStacked,title:t.title,xAxis:t.dataMapping.xAxis,yAxis:t.dataMapping.yAxis,groupBy:t.dataMapping.groupBy});let e=L(t.dataMapping.yAxis);switch(t.chartType){case"bar":if(Array.isArray(t.dataMapping.yAxis)&&t.dataMapping.yAxis.length>0&&(t.dataMapping.yAxis.some(e=>"string"!=typeof e&&"line"===e.type)||1===t.dataMapping.yAxis.length&&"string"!=typeof t.dataMapping.yAxis[0]&&"line"===t.dataMapping.yAxis[0].type))return console.log("Using MultiSeriesLineBarChart for mixed bar/line series or single line type"),(0,i.jsx)(U,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});if(!t.isStacked)return(0,i.jsx)(k,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});if(t.isStacked&&(t.dataMapping.groupBy||Array.isArray(t.dataMapping.yAxis)&&t.dataMapping.yAxis.length>1))return console.log("Using StackedBarChart for stacked mode with multiple Y fields or groupBy"),(0,i.jsx)(S,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});return(0,i.jsx)(k,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});case"stacked-bar":if(t.dataMapping.groupBy||Array.isArray(t.dataMapping.yAxis)&&t.dataMapping.yAxis.length>1)return console.log("Using StackedBarChart for stacked-bar type with groupBy or multiple Y fields"),(0,i.jsx)(S,{chartConfig:{...t,isStacked:!0,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});case"dual-axis":return(0,i.jsx)(V,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});case"pie":return(0,i.jsx)(q,{chartConfig:{...t,onFilterChange:e=>{Object.entries(e).forEach(e=>{let[t,l]=e;D(t,l)})}},data:h,isExpanded:a,onCloseExpanded:n,colorMap:A,filterValues:M,yAxisUnit:e});default:return(0,i.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.title}),t.subtitle&&(0,i.jsx)("p",{className:"text-sm text-gray-500",children:t.subtitle})]}),(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded border border-gray-200 h-64 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("p",{className:"text-lg font-medium text-indigo-600 mb-2",children:"Chart Preview"}),(0,i.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Type: ",t.chartType]}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"This chart type is not yet implemented. Please select bar or stacked-bar chart."}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs text-gray-500",children:[(0,i.jsxs)("div",{className:"bg-white p-2 rounded border",children:["X-Axis: ","string"==typeof t.dataMapping.xAxis?t.dataMapping.xAxis:Array.isArray(t.dataMapping.xAxis)?t.dataMapping.xAxis.join(", "):"Complex type"]}),(0,i.jsxs)("div",{className:"bg-white p-2 rounded border",children:["Y-Axis: ","string"==typeof t.dataMapping.yAxis?t.dataMapping.yAxis:Array.isArray(t.dataMapping.yAxis)?t.dataMapping.yAxis.map(e=>Y(e)).join(", "):"Complex type"]}),t.dataMapping.groupBy&&(0,i.jsxs)("div",{className:"bg-white p-2 rounded border",children:["Group By: ",t.dataMapping.groupBy]})]}),(0,i.jsxs)("div",{className:"mt-4 bg-white p-2 rounded border text-xs text-left",children:[(0,i.jsxs)("p",{className:"font-medium mb-1",children:["Sample Data (",Math.min(3,h.length)," of ",h.length," rows):"]}),(0,i.jsx)("pre",{className:"overflow-auto max-h-16",children:JSON.stringify(h.slice(0,3),null,2)})]})]})})]})}},[t,h,a,n,A,M]),L=e=>t.dataMapping.yAxisUnit?t.dataMapping.yAxisUnit:Array.isArray(e)&&e.length>0&&"string"!=typeof e[0]?e[0].unit:"string"==typeof e||Array.isArray(e)?void 0:e.unit;if(g)return(0,i.jsx)("div",{className:"p-4 rounded-md",children:(0,i.jsx)("div",{className:"flex",children:(0,i.jsxs)("div",{className:"ml-3",children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:"Error Loading Chart"}),(0,i.jsx)("div",{className:"mt-2 text-sm text-gray-700",children:(0,i.jsx)("p",{children:g})})]})})});if(!h.length)return(0,i.jsx)("div",{className:" p-4 rounded-md",children:(0,i.jsx)("p",{className:"text-gray-800",children:"No data available for this chart. API returned empty dataset."})});if(a){var T;return(0,i.jsx)(v.A,{isOpen:a,onClose:n||(()=>{}),title:t.title,subtitle:t.subtitle,isLoading:u,children:(0,i.jsxs)("div",{className:"h-[70vh] w-full overflow-hidden",children:[(null==(T=t.additionalOptions)?void 0:T.filters)&&(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 items-center mb-4 px-2",children:[t.additionalOptions.filters.timeFilter&&(0,i.jsx)(b.A,{value:M.timeFilter||t.additionalOptions.filters.timeFilter.options[0],onChange:e=>D("timeFilter",e),options:t.additionalOptions.filters.timeFilter.options.map(e=>({value:e,label:e}))}),t.additionalOptions.filters.currencyFilter&&(0,i.jsx)(y.A,{currency:M.currencyFilter||t.additionalOptions.filters.currencyFilter.options[0],options:t.additionalOptions.filters.currencyFilter.options,onChange:e=>D("currencyFilter",e)}),t.additionalOptions.filters.displayModeFilter&&(0,i.jsx)(j.A,{mode:M.displayModeFilter||t.additionalOptions.filters.displayModeFilter.options[0],onChange:e=>D("displayModeFilter",e)})]}),E()]})})}return E()}},41545:(e,t,l)=>{l.d(t,{A:()=>d});var i=l(12115),r=l(29300),a=l.n(r),n=l(41995),s=l(35083),o=["className","top","left","data","centroid","innerRadius","outerRadius","cornerRadius","startAngle","endAngle","padAngle","padRadius","pieSort","pieSortValues","pieValue","children","fill"];function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i])}return e}).apply(this,arguments)}function d(e){var t=e.className,l=e.top,r=e.left,d=e.data,u=e.centroid,h=e.innerRadius,f=e.outerRadius,g=e.cornerRadius,m=e.startAngle,p=e.endAngle,x=e.padAngle,v=e.padRadius,b=e.pieSort,y=e.pieSortValues,j=e.pieValue,w=e.children,F=e.fill,A=void 0===F?"":F,k=function(e,t){if(null==e)return{};var l,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)l=a[i],t.indexOf(l)>=0||(r[l]=e[l]);return r}(e,o),N=(0,s.JL)({innerRadius:void 0===h?0:h,outerRadius:f,cornerRadius:g,padRadius:v}),M=(0,s.rL)({startAngle:m,endAngle:p,padAngle:x,value:j,sort:b,sortValues:y}),S=M(void 0===d?[]:d);return w?i.createElement(i.Fragment,null,w({arcs:S,path:N,pie:M})):i.createElement(n.A,{className:"visx-pie-arcs-group",top:l,left:r},S.map(function(e,l){return i.createElement("g",{key:"pie-arc-"+l},i.createElement("path",c({className:a()("visx-pie-arc",t),d:N(e)||"",fill:null==A||"string"==typeof A?A:A(e)},k)),null==u?void 0:u(N.centroid(e),e))}))}},45191:(e,t,l)=>{l.d(t,{A:()=>n});var i=l(28749),r=l(95442),a=(0,l(70222).A)("domain","range","reverse","align","padding","round");function n(e){return a(function e(){var t,l,a=(0,r.A)().unknown(void 0),n=a.domain,s=a.range,o=0,c=1,d=!1,u=0,h=0,f=.5;function g(){var e=n().length,i=c<o,r=i?c:o,a=i?o:c;t=(a-r)/Math.max(1,e-u+2*h),d&&(t=Math.floor(t)),r+=(a-r-t*(e-u))*f,l=t*(1-u),d&&(r=Math.round(r),l=Math.round(l));var g=(function(e,t,l){e*=1,t*=1,l=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+l;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/l)),a=Array(r);++i<r;)a[i]=e+i*l;return a})(e).map(function(e){return r+t*e});return s(i?g.reverse():g)}return delete a.unknown,a.domain=function(e){return arguments.length?(n(e),g()):n()},a.range=function(e){return arguments.length?([o,c]=e,o*=1,c*=1,g()):[o,c]},a.rangeRound=function(e){return[o,c]=e,o*=1,c*=1,d=!0,g()},a.bandwidth=function(){return l},a.step=function(){return t},a.round=function(e){return arguments.length?(d=!!e,g()):d},a.padding=function(e){return arguments.length?(u=Math.min(1,h=+e),g()):u},a.paddingInner=function(e){return arguments.length?(u=Math.min(1,e),g()):u},a.paddingOuter=function(e){return arguments.length?(h=+e,g()):h},a.align=function(e){return arguments.length?(f=Math.max(0,Math.min(1,e)),g()):f},a.copy=function(){return e(n(),[o,c]).round(d).paddingInner(u).paddingOuter(h).align(f)},i.C.apply(g(),arguments)}(),e)}},74537:(e,t,l)=>{l.d(t,{A:()=>u});var i=l(12115),r=l(29300),a=l.n(r),n=l(14945),s=l(2758),o=["axisClassName","labelOffset","tickLength","tickLabelProps"];function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i])}return e}).apply(this,arguments)}var d={dx:"0.25em",dy:"0.25em",fill:"#222",fontFamily:"Arial",fontSize:10,textAnchor:"start"};function u(e){var t=e.axisClassName,l=e.labelOffset,r=e.tickLength,u=e.tickLabelProps,h=function(e,t){if(null==e)return{};var l,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)l=a[i],t.indexOf(l)>=0||(r[l]=e[l]);return r}(e,o),f="function"==typeof u?u:c({},d,u);return i.createElement(n.A,c({axisClassName:a()("visx-axis-right",t),labelOffset:void 0===l?36:l,orientation:s.A.right,tickLabelProps:f,tickLength:void 0===r?8:r},h))}},78398:(e,t,l)=>{l.d(t,{A:()=>a});var i=l(95442),r=(0,l(70222).A)("domain","range","reverse","unknown");function a(e){return r((0,i.A)(),e)}},81838:(e,t,l)=>{l.d(t,{A:()=>s});var i=l(95155);l(12115);let r=e=>{let{type:t,color:l}=e;return"circle"===t?(0,i.jsx)("div",{className:"h-2 w-2 rounded-full mr-1.5",style:{backgroundColor:l}}):(0,i.jsx)("div",{className:"h-2 w-2 rounded-sm mr-1.5",style:{backgroundColor:l}})},a=(e,t)=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)){let l=new Date(e);if(!isNaN(l.getTime())){if("W"===t)return"Week of ".concat(l.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}));if("M"===t)return l.toLocaleDateString("en-US",{month:"short",year:"numeric"});if("Q"===t){let e=Math.floor(l.getMonth()/3)+1;return"Q".concat(e,", ").concat(l.getFullYear())}else if("Y"===t)return l.getFullYear().toString();return l.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})}}return/^[A-Za-z]{3}\s\d{4}$/.test(e)||/^Q[1-4]\s\d{4}$/.test(e)||/^\d{4}$/.test(e),e},n=(e,t)=>{if("string"==typeof e){if(t){let l={USD:"$",EUR:"€",GBP:"\xa3",JPY:"\xa5",CNY:"\xa5",SOL:"SOL"},i=l[t]||t;if("SOL"===t){if(e.includes("SOL"))return e;for(let[t,i]of Object.entries(l))if("SOL"!==t&&e.startsWith(i))return"".concat(e.substring(i.length)," SOL");return"".concat(e," SOL")}for(let[r,a]of Object.entries(l))if(e.startsWith(a)&&r!==t)return e.replace(a,i)}return e}if("number"==typeof e){if(t)switch(t){case"USD":return"$".concat(e.toLocaleString());case"EUR":return"€".concat(e.toLocaleString());case"GBP":return"\xa3".concat(e.toLocaleString());case"JPY":case"CNY":return"\xa5".concat(e.toLocaleString());case"SOL":return"".concat(e.toLocaleString()," SOL");default:return"".concat(t).concat(e.toLocaleString())}return e.toLocaleString()}return String(e)},s=e=>{let{title:t,items:l,top:s,left:o,isModal:c=!1,timeFilter:d,currencyFilter:u}=e,h=l.some(e=>e.axis),f=a(t,d);return(0,i.jsxs)("div",{className:"absolute z-10 pointer-events-none bg-gray-900/95 shadow-lg border border-gray-800 rounded-md p-2 text-xs min-w-[120px]",style:{top:"".concat(s,"px"),left:o>(c?500:250)?"".concat(o-160,"px"):"".concat(o+10,"px"),transform:"translateY(-100%)"},children:[(0,i.jsx)("div",{className:"text-gray-400 text-[10px] font-normal pb-1 mb-1 border-b border-gray-800",children:f}),(0,i.jsx)("div",{className:"space-y-1",children:l.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,i.jsx)(r,{type:e.shape||"circle",color:e.color}),(0,i.jsx)("span",{className:"text-gray-400 font-normal ml-2",children:e.label}),h&&e.axis&&(0,i.jsxs)("span",{className:"ml-1 text-[9px] text-gray-500",children:["(",e.axis," axis)"]})]}),(0,i.jsx)("span",{className:"text-gray-300 font-normal ml-4",children:n(e.value,u)})]},"tooltip-item-".concat(t)))})]})}},95442:(e,t,l)=>{l.d(t,{A:()=>function e(){var t=new i,l=[],r=[],a=s;function o(e){let i=t.get(e);if(void 0===i){if(a!==s)return a;t.set(e,i=l.push(e)-1)}return r[i%r.length]}return o.domain=function(e){if(!arguments.length)return l.slice();for(let r of(l=[],t=new i,e))t.has(r)||t.set(r,l.push(r)-1);return o},o.range=function(e){return arguments.length?(r=Array.from(e),o):r.slice()},o.unknown=function(e){return arguments.length?(a=e,o):a},o.copy=function(){return e(l,r).unknown(a)},n.C.apply(o,arguments),o}});class i extends Map{constructor(e,t=a){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(let[t,l]of e)this.set(t,l)}get(e){return super.get(r(this,e))}has(e){return super.has(r(this,e))}set(e,t){return super.set(function({_intern:e,_key:t},l){let i=t(l);return e.has(i)?e.get(i):(e.set(i,l),l)}(this,e),t)}delete(e){return super.delete(function({_intern:e,_key:t},l){let i=t(l);return e.has(i)&&(l=e.get(i),e.delete(i)),l}(this,e))}}function r({_intern:e,_key:t},l){let i=t(l);return e.has(i)?e.get(i):l}function a(e){return null!==e&&"object"==typeof e?e.valueOf():e}var n=l(28749);let s=Symbol("implicit")}}]);