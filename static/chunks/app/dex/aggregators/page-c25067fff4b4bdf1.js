(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{23449:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>J});var l=a(95155),r=a(12115),s=a(79111),o=a(41995),i=a(4503),n=a(45191),c=a(4904),u=a(78398),d=a(50109),m=a(58888),g=a(72630),h=a(52594),x=a(51078),f=a(81838);let v=[{date:"2023-01-01",aggregator:"Jupiter",volume:12e7,market_share:.45},{date:"2023-02-01",aggregator:"Jupiter",volume:14e7,market_share:.47},{date:"2023-03-01",aggregator:"Jupiter",volume:16e7,market_share:.48},{date:"2023-04-01",aggregator:"Jupiter",volume:18e7,market_share:.5},{date:"2023-05-01",aggregator:"Jupiter",volume:2e8,market_share:.52},{date:"2023-06-01",aggregator:"Jupiter",volume:22e7,market_share:.53},{date:"2023-01-01",aggregator:"Jito",volume:8e7,market_share:.3},{date:"2023-02-01",aggregator:"Jito",volume:85e6,market_share:.28},{date:"2023-03-01",aggregator:"Jito",volume:9e7,market_share:.27},{date:"2023-04-01",aggregator:"Jito",volume:95e6,market_share:.26},{date:"2023-05-01",aggregator:"Jito",volume:1e8,market_share:.26},{date:"2023-06-01",aggregator:"Jito",volume:105e6,market_share:.25},{date:"2023-01-01",aggregator:"OpenBook",volume:4e7,market_share:.15},{date:"2023-02-01",aggregator:"OpenBook",volume:45e6,market_share:.15},{date:"2023-03-01",aggregator:"OpenBook",volume:5e7,market_share:.15},{date:"2023-04-01",aggregator:"OpenBook",volume:55e6,market_share:.15},{date:"2023-05-01",aggregator:"OpenBook",volume:6e7,market_share:.16},{date:"2023-06-01",aggregator:"OpenBook",volume:65e6,market_share:.16},{date:"2023-01-01",aggregator:"Others",volume:25e6,market_share:.1},{date:"2023-02-01",aggregator:"Others",volume:3e7,market_share:.1},{date:"2023-03-01",aggregator:"Others",volume:35e6,market_share:.1},{date:"2023-04-01",aggregator:"Others",volume:32e6,market_share:.09},{date:"2023-05-01",aggregator:"Others",volume:28e6,market_share:.06},{date:"2023-06-01",aggregator:"Others",volume:25e6,market_share:.06}];async function p(){try{var e,t;console.log("Attempting to fetch aggregators data from API...");let a=await fetch("https://analytics.topledger.xyz/tl/api/queries/12428/results.json?api_key=M50ElvuV9FtY3XlSVP2GtGfSTefJ13C8z4y742da");if(!a.ok)throw Error("Failed to fetch aggregators data: ".concat(a.status," ").concat(a.statusText));let l=await a.json();if(!(null==l||null==(t=l.query_result)||null==(e=t.data)?void 0:e.rows)||!Array.isArray(l.query_result.data.rows))return console.warn("API response does not have the expected structure, using fallback data"),b();let r=l.query_result.data.rows.map(e=>({month:j(e.month),aggregator:e.aggregator,volume:parseFloat(e.volume)||0,signers:parseInt(e.Traders)||0}));return console.log("Processed ".concat(r.length," aggregators data points from API")),r}catch(e){return console.error("Error fetching aggregators data:",e),console.log("Using fallback data due to error"),b()}}function b(){return console.log("Converting fallback data"),v.map(e=>({month:j(e.date),aggregator:e.aggregator,volume:e.volume,signers:Math.round(e.volume/1e4)}))}function j(e){let t=new Date(e),a=t.toLocaleString("default",{month:"short"}),l=t.getFullYear();return"".concat(a," ").concat(l)}function k(e){return e>=1e9?"$".concat((e/1e9).toFixed(1),"B"):e>=1e6?"$".concat((e/1e6).toFixed(1),"M"):e>=1e3?"$".concat((e/1e3).toFixed(1),"K"):"$".concat(e.toFixed(0))}function w(e){return e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toFixed(0)}function y(e){return Array.from(new Set(e.map(e=>e.aggregator)))}function N(e){return Array.from(new Set(e.map(e=>e.month)))}var A=a(80229),S=a(85204),D=a(42028),C=a(6828);let M={Jupiter:C.Tj[0],OKX:C.Tj[2],"Non-Aggregator":C.Tj[1],default:C.Tj[3]},E={grid:C.h5,axisLines:C.h5,tickLabels:C.Dc},T=(e,t,a)=>{if(M[e])return M[e];let l=[...t].filter(e=>!M[e]).sort((e,t)=>(a[t]||0)-(a[e]||0)).indexOf(e);return -1===l?M.default:C.Tj[(l+4)%C.Tj.length]},L=e=>{let{dataType:t,displayMode:a,isModalOpen:v,onModalClose:b}=e,[M,L]=(0,r.useState)([]),[V,F]=(0,r.useState)(!0),[_,O]=(0,r.useState)(null),[P,B]=(0,r.useState)([]),[R,X]=(0,r.useState)([]),[z,J]=(0,r.useState)([]),[q,I]=(0,r.useState)(null),[W,G]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)([]),[$,K]=(0,r.useState)([]),[H,Q]=(0,r.useState)(!0),[U,ee]=(0,r.useState)(t),[et,ea]=(0,r.useState)(a),[el,er]=(0,r.useState)(null),[es,eo]=(0,r.useState)(!1),ei=(0,r.useRef)(null),en=(0,r.useRef)(!0),ec=(0,r.useRef)(null),eu=(0,r.useRef)(!0),ed=(0,r.useRef)(null),em=(0,r.useRef)(null),[eg,eh]=(0,r.useState)({visible:!1,x:0,y:0,month:"",items:[]}),ex=(0,r.useCallback)(async()=>{F(!0),O(null);try{let e=await p();L(e),J(e);let t=y(e),a=N(e);B(t),X(a)}catch(e){console.error("[AggregatorsChart] Error loading chart data:",e),O("Failed to load data. Please try again later."),L([]),J([])}finally{F(!1)}},[]);(0,r.useEffect)(()=>{ex()},[ex]),(0,r.useEffect)(()=>{v&&(Q(!0),Z(M),K(z),ee(t),0===Y.length&&ea(a),er(q),eo(W),Q(!1))},[v,M,z,t,q,W,Y.length]);let ef=(0,r.useCallback)(e=>{if(!e){W&&(I(null),G(!1),J(M)),ei.current&&(clearTimeout(ei.current),ei.current=null,en.current=!0);return}let{x0:t,x1:a}=e,l=new Date(t),r=new Date(a);if(!(isNaN(l.getTime())||isNaN(r.getTime()))&&(I([l,r]),W||G(!0),en.current)){en.current=!1;let e=M.filter(e=>{let t=new Date(j(e.month)).getTime();return t>=l.getTime()&&t<=r.getTime()});0===e.length?J(M):J(e),ei.current=setTimeout(()=>{en.current=!0,ei.current=null},100)}},[W,M]),ev=(0,r.useCallback)(e=>{if(!e){es&&(er(null),eo(!1),K(Y)),ec.current&&(clearTimeout(ec.current),ec.current=null,eu.current=!0);return}let{x0:t,x1:a}=e,l=new Date(t),r=new Date(a);if(!(isNaN(l.getTime())||isNaN(r.getTime()))&&(er([l,r]),es||eo(!0),eu.current)){eu.current=!1;let e=Y.filter(e=>{let t=new Date(j(e.month)).getTime();return t>=l.getTime()&&t<=r.getTime()});0===e.length?K(Y):K(e),ec.current=setTimeout(()=>{eu.current=!0,ec.current=null},100)}},[es,Y]),ep=(0,r.useCallback)((e,t)=>e&&0!==e.length?Object.values(e.reduce((e,a)=>{let l=a.month;e[l]||(e[l]={date:l,value:0});let r="volume"===t?a.volume:a.signers;return e[l].value+=r,e},{})).map(e=>({date:new Date(e.date).toISOString(),value:e.value})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()):[],[]),eb=(0,r.useCallback)((e,t,a,l,r)=>{let s={};return a.forEach(e=>{s[e]={},t.forEach(t=>{s[e][t]=0})}),e.forEach(e=>{if(s[e.month]){let t="volume"===l?e.volume:e.signers;s[e.month][e.aggregator]=t}}),a.map(e=>{let a={month:e},l=0;return"percent"===r&&t.forEach(t=>{l+=s[e][t]||0}),t.forEach(t=>{let o=s[e][t]||0;"percent"===r&&l>0?a[t]=o/l*100:a[t]=o}),a})},[]),ej=(0,r.useCallback)((e,t,a)=>{let l={};return t.forEach(e=>{l[e]=0}),e.forEach(e=>{let t="volume"===a?e.volume:e.signers;l[e.month]=(l[e.month]||0)+t}),l},[]),ek=(0,r.useCallback)(function(e,t,a,l,r,s,o,i){let n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=n?em.current:ed.current;if(!c)return;let u=c.getBoundingClientRect(),d=e.clientX-u.left,m=e.clientY-u.top,g=N(r),h=ej(r,g,o),x=r.filter(e=>e.month===t),f=s.map(e=>{let a=x.find(t=>t.aggregator===e),l=a?"volume"===o?a.volume:a.signers:0,n=l;return i&&h[t]&&(n=l/h[t]*100),{aggregator:e,value:n,rawValue:l,color:T(e,s,ej(r,g,o))}}).sort((e,t)=>t.value-e.value);eh({visible:!0,x:d,y:m,month:t,items:f})},[ej]),ew=()=>{eh(e=>({...e,visible:!1}))};(0,r.useEffect)(()=>()=>{ei.current&&clearTimeout(ei.current),ec.current&&clearTimeout(ec.current)},[]);let ey=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=e?es?$:Y:W?z:M,h=y(r),v=N(r),p=e?U:t,b=e?et:a,A="percent"===b;if(e?H:V)return(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(x.A,{size:"sm"})});if(_||0===r.length)return(0,l.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 text-sm",children:(0,l.jsx)("p",{children:_||"No data available"})});let S=eb(r,h,v,p,b),L=ej(r,v,p);return e?(0,l.jsxs)("div",{className:"flex flex-col h-full w-full",children:[eg.visible&&(0,l.jsx)(f.A,{title:j(eg.month),items:eg.items.map(e=>({color:e.color,label:e.aggregator,value:A?"".concat(e.value.toFixed(1),"%"):"volume"===p?k(e.rawValue||e.value):w(e.rawValue||e.value),shape:"square"})),top:eg.y,left:eg.x,isModal:e}),(0,l.jsx)("div",{className:"h-[85%] w-full relative",ref:em,onMouseMove:e=>{let t=em.current;if(!t)return;let a=t.getBoundingClientRect(),l=e.clientX-a.left,r=e.clientY-a.top,s={right:25,left:45},o=a.width-s.left-s.right;if(l<s.left||l>o+s.left)return;let i=es?$:Y,n=N(i),c=y(i),u=ej(i,n,U),d="percent"===et,m=Math.min(n.length-1,Math.max(0,Math.floor((l-s.left)/(o/n.length))));if(m>=0&&m<n.length){let e=n[m],t=i.filter(t=>t.month===e),a=c.map(a=>{let l=t.find(e=>e.aggregator===a),r=l?"volume"===U?l.volume:l.signers:0,s=r;return d&&u[e]&&(s=r/u[e]*100),{aggregator:a,value:s,rawValue:r,color:T(a,c,u)}}).filter(e=>e.rawValue>0).sort((e,t)=>t.rawValue-e.rawValue);eh({visible:!0,x:l,y:r,month:e,items:a})}},onMouseLeave:ew,children:(0,l.jsx)(s.A,{children:t=>{let{width:a,height:s}=t;if(a<10||s<10)return null;let x={top:5,right:25,bottom:30,left:45},f=a-x.left-x.right,b=s-x.top-x.bottom,y=(0,n.A)({domain:v,padding:.2,range:[0,f]}),N=0;A?N=100:v.forEach(e=>{N=Math.max(N,L[e]||0)});let D=(0,c.A)({domain:[0,A?100:1.1*N],range:[b,0],nice:!0}),C=(0,u.A)({domain:h,range:h.map(e=>T(e,h,ej(r,v,p)))});return(0,l.jsx)("svg",{width:a,height:s,children:(0,l.jsxs)(o.A,{left:x.left,top:x.top,children:[(e?es:W)&&(0,l.jsx)("text",{x:0,y:-8,fontSize:8,fill:C(h[0]),textAnchor:"start",children:"Filtered: ".concat(r.length," item").concat(1!==r.length?"s":"")}),(0,l.jsx)(d.A,{scale:D,width:f,height:b,stroke:E.grid,strokeOpacity:.5,strokeDasharray:"2,3",numTicks:5}),(0,l.jsx)(m.A,{scale:D,hideZero:!0,stroke:E.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,tickFormat:e=>A?"".concat(e,"%"):"volume"===p?k(e):w(e),tickLabelProps:()=>({fill:E.tickLabels,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dx:"-0.6em",dy:"0.25em"})}),(0,l.jsx)(g.A,{top:b,scale:y,stroke:E.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,tickFormat:e=>j(e),tickLabelProps:(e,t)=>({fill:E.tickLabels,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:0===t?"start":"middle",dy:"0.5em",dx:0===t?"0.5em":0})}),(0,l.jsx)(i.A,{data:S,keys:h,x:e=>e.month,xScale:y,yScale:D,color:C,children:t=>t.map(t=>t.bars.map(a=>{let s=a.bar[a.key],o=eg.visible&&eg.month===a.bar.data.month&&eg.items.some(e=>e.aggregator===a.key);return(0,l.jsx)("rect",{x:a.x,y:a.y,height:a.height,width:a.width,fill:a.color,opacity:o?1:.7,rx:2,onMouseMove:t=>ek(t,a.bar.data.month,a.key,s,r,h,p,A,e),onMouseLeave:ew},"bar-stack-".concat(t.index,"-").concat(a.index))}))})]})})}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(D.A,{data:ep(e?Y:M,e?U:t),isModal:e,activeBrushDomain:e?el:q,onBrushChange:e?ev:ef,onClearBrush:()=>{e?(er(null),eo(!1),K(Y)):(I(null),G(!1),J(M))},getDate:e=>e.date,getValue:e=>e.value,lineColor:"volume"===t?C.Tj[0]:C.Tj[2],margin:{top:5,right:20,bottom:10,left:45}})})]}):(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row h-[360px] lg:h-80",children:[(0,l.jsx)("div",{className:"flex-grow lg:pr-3 lg:border-r lg:border-gray-900 h-80 lg:h-auto",children:(0,l.jsxs)("div",{className:"h-full w-full relative",ref:ed,onMouseMove:e=>{let l=ed.current;if(!l)return;let r=l.getBoundingClientRect(),s=e.clientX-r.left,o=e.clientY-r.top,i={right:25,left:45},n=r.width-i.left-i.right;if(s<i.left||s>n+i.left)return;let c=W?z:M,u=N(c),d=y(c),m=ej(c,u,t),g="percent"===a,h=Math.min(u.length-1,Math.max(0,Math.floor((s-i.left)/(n/u.length))));if(h>=0&&h<u.length){let e=u[h],a=c.filter(t=>t.month===e),l=d.map(l=>{let r=a.find(e=>e.aggregator===l),s=r?"volume"===t?r.volume:r.signers:0,o=s;return g&&m[e]&&(o=s/m[e]*100),{aggregator:l,value:o,rawValue:s,color:T(l,d,m)}}).filter(e=>e.rawValue>0).sort((e,t)=>t.rawValue-e.rawValue);eh({visible:!0,x:s,y:o,month:e,items:l})}},onMouseLeave:ew,children:[eg.visible&&(0,l.jsx)(f.A,{title:j(eg.month),items:eg.items.map(e=>({color:e.color,label:e.aggregator,value:A?"".concat(e.value.toFixed(1),"%"):"volume"===t?k(e.rawValue||e.value):w(e.rawValue||e.value),shape:"square"})),top:eg.y,left:eg.x,isModal:!1}),(0,l.jsx)("div",{className:"h-[85%] w-full",children:(0,l.jsx)(s.A,{children:e=>{let{width:t,height:a}=e;return eN(t,a,r,h,v,p,A,S,L,!1)}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(D.A,{data:ep(M,t),isModal:!1,activeBrushDomain:q,onBrushChange:ef,onClearBrush:()=>{I(null),G(!1),J(M)},getDate:e=>e.date,getValue:e=>e.value,lineColor:"volume"===t?C.Tj[0]:C.Tj[2],margin:{top:5,right:20,bottom:10,left:45}})})]})}),(0,l.jsx)("div",{className:"w-full lg:w-1/5 mt-2 lg:mt-0 lg:pl-3 flex flex-row lg:flex-col overflow-x-auto lg:overflow-x-visible",children:(0,l.jsxs)("div",{className:"flex flex-row lg:flex-col gap-4 lg:gap-3 pt-1 pb-2 lg:pb-0",children:[(0,l.jsx)("div",{className:"text-[10px] text-gray-400 mb-2 whitespace-nowrap",children:"AGGREGATORS"}),(0,l.jsx)("div",{className:"flex flex-row lg:flex-col gap-4 lg:gap-3",children:h.length>0?h.map(e=>(0,l.jsxs)("div",{className:"flex items-start whitespace-nowrap",children:[(0,l.jsx)("div",{className:"w-2 h-2 mr-2 rounded-sm mt-0.5",style:{background:T(e,h,ej(M,N(M),t))}}),(0,l.jsx)("span",{className:"text-xs text-gray-300 truncate",title:e,children:e.length>12?"".concat(e.substring(0,12),"..."):e})]},e)):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("div",{className:"text-xs text-gray-300",children:"Loading..."})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-purple-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("div",{className:"text-xs text-gray-300",children:"Loading..."})]})]})})]})})]})},eN=(e,t,a,r,s,h,x,f,v,p)=>{if(e<10||t<10)return null;let b={top:5,right:25,bottom:30,left:45},y=e-b.left-b.right,A=t-b.top-b.bottom,S=(0,n.A)({domain:s,padding:.2,range:[0,y]}),D=0;x?D=100:s.forEach(e=>{D=Math.max(D,v[e]||0)});let C=(0,c.A)({domain:[0,x?100:1.1*D],range:[A,0],nice:!0}),M=(0,u.A)({domain:r,range:r.map(e=>T(e,r,ej(a,N(a),h)))});return(0,l.jsx)("svg",{width:e,height:t,children:(0,l.jsxs)(o.A,{left:b.left,top:b.top,children:[(p?es:W)&&(0,l.jsx)("text",{x:0,y:-8,fontSize:8,fill:M(r[0]),textAnchor:"start",children:"Filtered: ".concat(a.length," item").concat(1!==a.length?"s":"")}),(0,l.jsx)(d.A,{scale:C,width:y,height:A,stroke:E.grid,strokeOpacity:.5,strokeDasharray:"2,3",numTicks:5}),(0,l.jsx)(m.A,{scale:C,hideZero:!0,stroke:E.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,tickFormat:e=>x?"".concat(e,"%"):"volume"===h?k(e):w(e),tickLabelProps:()=>({fill:E.tickLabels,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dx:"-0.6em",dy:"0.25em"})}),(0,l.jsx)(g.A,{top:A,scale:S,stroke:E.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,tickFormat:e=>j(e),tickLabelProps:(e,t)=>({fill:E.tickLabels,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:0===t?"start":"middle",dy:"0.5em",dx:0===t?"0.5em":0})}),(0,l.jsx)(i.A,{data:f,keys:r,x:e=>e.month,xScale:S,yScale:C,color:M,children:e=>e.map(e=>e.bars.map(t=>{let s=t.bar[t.key],o=eg.visible&&eg.month===t.bar.data.month&&eg.items.some(e=>e.aggregator===t.key);return(0,l.jsx)("rect",{x:t.x,y:t.y,height:t.height,width:t.width,fill:t.color,opacity:o?1:.7,rx:2,onMouseMove:e=>ek(e,t.bar.data.month,t.key,s,a,r,h,x,p),onMouseLeave:ew},"bar-stack-".concat(e.index,"-").concat(t.index))}))})]})})};return(0,l.jsxs)("div",{className:"h-full w-full",children:[ey(),(0,l.jsx)(h.A,{isOpen:v,onClose:b,title:"DEX Aggregators",subtitle:"Trading volume and active traders by aggregator",children:(0,l.jsxs)("div",{className:"p-4 w-full h-full",children:[(0,l.jsx)("div",{className:"flex items-center justify-between pl-1 py-0 mb-3",children:(0,l.jsxs)("div",{className:"flex space-x-4 items-center",children:[(0,l.jsx)(A.A,{selectedDataType:U,onChange:e=>{ee(e)},isCompact:!0}),(0,l.jsx)(S.A,{mode:et,onChange:e=>{ea(e)},isCompact:!0})]})}),(0,l.jsx)("div",{className:"h-px bg-gray-900 w-full mb-3"}),(0,l.jsx)("div",{className:"h-[60vh]",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row h-full",children:[(0,l.jsx)("div",{className:"flex-grow lg:pr-3 lg:border-r lg:border-gray-900 h-[85%] lg:h-auto",children:ey(!0)}),(0,l.jsx)("div",{className:"w-full lg:w-1/5 mt-2 lg:mt-0 lg:pl-3 flex flex-row lg:flex-col overflow-x-auto lg:overflow-x-visible",children:(0,l.jsxs)("div",{className:"flex flex-row lg:flex-col gap-4 lg:gap-3 pt-1 pb-2 lg:pb-0",children:[(0,l.jsx)("div",{className:"text-[10px] text-gray-400 mb-2 whitespace-nowrap",children:"AGGREGATORS"}),(0,l.jsx)("div",{className:"flex flex-row lg:flex-col gap-4 lg:gap-3",children:y(Y).length>0?y(Y).map(e=>(0,l.jsxs)("div",{className:"flex items-start whitespace-nowrap",children:[(0,l.jsx)("div",{className:"w-2 h-2 mr-2 rounded-sm mt-0.5",style:{background:T(e,y(M),ej(M,N(M),t))}}),(0,l.jsx)("span",{className:"text-xs text-gray-300 truncate",title:e,children:e.length>12?"".concat(e.substring(0,12),"..."):e})]},e)):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("div",{className:"text-xs text-gray-300",children:"Loading..."})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-purple-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("div",{className:"text-xs text-gray-300",children:"Loading..."})]})]})})]})})]})})]})})]})};async function V(){console.log("[DexVolumeData] Starting to fetch DEX volume by medium data");try{let e=await fetch("https://analytics.topledger.xyz/tl/api/queries/13234/results.json?api_key=jes4jbtggmsezoHwIxltmSjmQxmExPOgnQNhFzZm");if(!e.ok)throw Error("API request failed with status ".concat(e.status));let t=(await e.json()).query_result.data.rows;console.log("[DexVolumeData] Fetched raw data:",t.length,"rows");let a=t.map(e=>({dex:e.dex,volume:e.Volume,medium:e.medium})),l=function(e){let t={},a=Array.from(new Set(e.map(e=>e.dex))).sort();return a.forEach(e=>{t[e]={Direct:0,Aggregator:0}}),e.forEach(e=>{t[e.dex]&&("Direct"===e.medium||"Aggregator"===e.medium)&&(t[e.dex][e.medium]+=e.volume)}),a.map(e=>{let a=t[e].Direct||0,l=t[e].Aggregator||0;return{dex:e,Direct:a,Aggregator:l,total:a+l}}).sort((e,t)=>t.total-e.total)}(a);return console.log("[DexVolumeData] Processed data for chart:",l.length,"dexes"),{rawData:t,chartData:l}}catch(e){throw console.error("[DexVolumeData] Error fetching DEX volume data:",e),e}}function F(e){var t;return"$".concat(null==(t=e)||isNaN(t)?"0":t>=1e9?"".concat((t/1e9).toFixed(1),"B"):t>=1e6?"".concat((t/1e6).toFixed(1),"M"):t>=1e3?"".concat((t/1e3).toFixed(1),"K"):t.toFixed(0))}var _=a(7545);let O=e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},P={Direct:C.Tj[0],Aggregator:C.Tj[1]},B={grid:C.Vg,axisLines:C.h5,tickLabels:C.Dc},R=["Direct","Aggregator"];function X(e){let{displayMode:t,isModalOpen:a,onModalClose:v}=e,[p,b]=(0,r.useState)([]),[j,k]=(0,r.useState)(!0),[w,y]=(0,r.useState)(null),[N,A]=(0,r.useState)([]),[D,M]=(0,r.useState)(!0),[E,T]=(0,r.useState)(null),[L,X]=(0,r.useState)(t),[z,J]=(0,r.useState)({visible:!1,dataPoint:null,medium:"",value:0,left:0,top:0,items:[]}),q=(0,r.useRef)(null),I=(0,r.useRef)(null),W=(0,r.useCallback)(async()=>{console.log("[DexVolumeChart] Starting to fetch data"),k(!0),y(null);try{let e=await V();if(console.log("[DexVolumeChart] Fetched data:",e),e.chartData&&0!==e.chartData.length){let t=e.chartData.slice(0,10);b(t)}else console.warn("[DexVolumeChart] No data returned from API"),y("No data available from API"),b([])}catch(t){console.error("[DexVolumeChart] Error fetching data:",t);let e="Failed to load data.";t instanceof Error&&(e=t.message||e),y("Failed to load DEX volume data: "+e),b([])}finally{k(!1)}},[]),G=(0,r.useCallback)(async()=>{console.log("[DexVolumeChart] Starting to fetch modal data"),M(!0),T(null);try{let e=await V();console.log("[DexVolumeChart] Fetched modal data"),e.chartData&&0!==e.chartData.length?A(e.chartData):(console.warn("[DexVolumeChart] No modal data returned from API"),T("No data available from API"),A([]))}catch(t){console.error("[DexVolumeChart] Error fetching modal data:",t);let e="Failed to load data.";t instanceof Error&&(e=t.message||e),T("Failed to load DEX volume data: "+e),A([])}finally{M(!1)}},[]);(0,r.useEffect)(()=>{W()},[W]);let Y=(0,r.useCallback)(e=>{X(e)},[]);(0,r.useEffect)(()=>{a&&(0===N.length&&X(t),p.length>0?(A(p),M(!1)):G())},[a,p,G,N.length]);let Z=(0,r.useCallback)(function(e,t,a,l){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=r?I.current:q.current;if(!s)return;let o=s.getBoundingClientRect();J({visible:!0,dataPoint:t,medium:a,value:l,left:e.clientX-o.left,top:e.clientY-o.top,items:[]})},[]),$=(0,r.useCallback)(()=>{z.visible&&J(e=>({...e,visible:!1}))},[z.visible]),K=()=>R.map(e=>({key:e,displayName:e,shape:"square",color:P[e]||C.Dc})),H=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("[DexVolumeChart] Rendering chart. Modal:",e);let a=e?D:j,r=e?E:w,h=e?L:t,v=e?N:p;return a?(0,l.jsx)(x.A,{size:"sm"}):r||0===v.length?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,l.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:r||"No data available"}),(0,l.jsx)(_.A,{onClick:e?G:W,children:(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(O,{className:"w-3.5 h-3.5"}),(0,l.jsx)("span",{children:"Refresh"})]})})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full w-full",children:[z.visible&&z.dataPoint&&(0,l.jsx)(f.A,{title:z.dataPoint.dex,items:z.items&&z.items.length>0?z.items:[{color:P[z.medium]||C.Dc,label:z.medium,value:F(z.value),shape:"square"}],top:z.top,left:z.left,isModal:e}),(0,l.jsx)("div",{className:"h-full w-full overflow-hidden relative",onMouseLeave:$,ref:e?I:q,onMouseMove:t=>{let a=e?I.current:q.current;if(!a)return;let l=a.getBoundingClientRect(),r=t.clientX-l.left,s=t.clientY-l.top,o={right:20,left:70},i=l.width-o.left-o.right;if(r<o.left||r>i+o.left)return;let n=e?N:p,c=i/n.length,u=Math.min(n.length-1,Math.max(0,Math.floor((r-o.left)/c)));if(u>=0&&u<n.length){let e=n[u],t=R.map(t=>({color:P[t]||C.Dc,label:t,value:F(Number(e[t]||0)),rawValue:Number(e[t]||0),shape:"square"})).filter(e=>e.rawValue>0).sort((e,t)=>t.rawValue-e.rawValue);J({visible:!0,dataPoint:e,medium:"",value:0,left:r,top:s,items:t})}},children:(0,l.jsx)(s.A,{children:t=>{let{width:a,height:r}=t;if(a<=0||r<=0)return null;let s={top:20,right:20,bottom:60,left:70},x=a-s.left-s.right,f=r-s.top-s.bottom;if(x<=0||f<=0)return null;let p=(0,n.A)({domain:v.map(e=>e.dex),padding:.3,range:[0,x]}),b=0;"absolute"===h?v.forEach(e=>{let t=0;R.forEach(a=>{t+=Number(e[a]||0)}),b=Math.max(b,t)}):b=100;let j=(0,c.A)({domain:[0,"percent"===h?100:1.1*b],range:[f,0],nice:!0}),k=(0,u.A)({domain:R,range:R.map(e=>P[e]||C.Dc)}),w=[...v];return"percent"===h&&(w=v.map(e=>{let t=e.total,a={dex:e.dex,total:e.total};return R.forEach(l=>{t>0?a[l]=(Number(e[l])||0)/t*100:a[l]=0}),a})),(0,l.jsx)("svg",{width:a,height:r,className:"overflow-visible",children:(0,l.jsxs)(o.A,{left:s.left,top:s.top,children:[(0,l.jsx)(d.A,{scale:j,width:x,stroke:B.grid,strokeDasharray:"2,3",strokeOpacity:.5,numTicks:5}),(0,l.jsx)(i.A,{data:w,keys:R,x:e=>e.dex,xScale:p,yScale:j,color:k,children:t=>t.map(t=>t.bars.map(a=>{var r;return(0,l.jsx)("rect",{x:a.x,y:a.y,height:a.height,width:a.width,fill:a.color,opacity:z.visible&&(null==(r=z.dataPoint)?void 0:r.dex)===a.bar.data.dex&&z.medium===R[a.index]?.9:.7,rx:2,onMouseEnter:t=>Z(t,a.bar.data,R[a.index],Number(a.bar.data[R[a.index]]||0),e),onMouseMove:t=>{let a=e?I.current:q.current;if(!a)return;let l=a.getBoundingClientRect(),r=t.clientX-l.left,s=t.clientY-l.top;J(e=>({...e,left:r,top:s}))}},"bar-stack-".concat(t.index,"-").concat(a.index))}))}),(0,l.jsx)(g.A,{top:f,scale:p,stroke:B.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,tickLabelProps:()=>({fill:B.tickLabels,fontSize:10,textAnchor:"middle",dy:"1.2em",verticalAnchor:"start"})}),(0,l.jsx)(m.A,{scale:j,stroke:B.axisLines,strokeWidth:.5,tickStroke:"transparent",tickLength:0,numTicks:5,tickFormat:e=>"percent"===h?"".concat(Number(e).toFixed(0),"%"):F(Number(e)),tickLabelProps:()=>({fill:B.tickLabels,fontSize:10,textAnchor:"end",dx:"-0.6em",dy:"0.25em"})})]})})}})})]})};return(0,l.jsxs)("div",{className:"h-full w-full relative",children:[(0,l.jsx)("div",{className:"h-full",children:H(!1)}),(0,l.jsx)(h.A,{isOpen:a,onClose:v,title:"DEX Volume by Source",subtitle:"Volume distribution between direct trades and aggregator-routed trades",children:(()=>{let e=K();return(0,l.jsxs)("div",{className:"p-4 w-full h-full",children:[(0,l.jsx)("div",{className:"flex items-center justify-between pl-1 py-0 mb-3",children:(0,l.jsx)("div",{className:"flex space-x-4 items-center",children:(0,l.jsx)(S.A,{mode:L,onChange:Y})})}),(0,l.jsx)("div",{className:"h-px bg-gray-900 w-full mb-3"}),(0,l.jsx)("div",{className:"h-[60vh]",children:(0,l.jsxs)("div",{className:"flex h-full",children:[(0,l.jsx)("div",{className:"w-[90%] h-full pr-3 border-r border-gray-900",children:H(!0)}),(0,l.jsxs)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:[(0,l.jsx)("div",{className:"text-[10px] text-gray-400 mb-2",children:"SOURCE"}),!D&&N.length>0?(0,l.jsx)("div",{className:"flex flex-col gap-2 max-h-[600px] w-[125px] overflow-y-auto [&::-webkit-scrollbar]:w-1.5  [&::-webkit-scrollbar-track]:bg-transparent  [&::-webkit-scrollbar-thumb]:bg-gray-700/40 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-gray-600/60 scrollbar-thin scrollbar-track-transparent scrollbar-thumb-gray-700/40",children:e.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2.5 h-2.5 mr-1.5 rounded-sm mt-0.5",style:{background:e.color}}),(0,l.jsx)("span",{className:"text-[11px] text-gray-300",children:e.displayName})]},"modal-legend-".concat(t)))}):(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2.5 h-2.5 bg-blue-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("span",{className:"text-[11px] text-gray-300",children:"Loading..."})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-2.5 h-2.5 bg-orange-500 mr-2 rounded-sm mt-0.5 animate-pulse"}),(0,l.jsx)("span",{className:"text-[11px] text-gray-300",children:"Loading..."})]})]})]})]})})]})})()})]})}var z=a(21903);function J(){let[e,t]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),[o,i]=(0,r.useState)("volume"),[n,c]=(0,r.useState)("absolute"),[u,d]=(0,r.useState)("absolute");return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(z.A,{title:"DEX Aggregators",description:"Trading volume and active traders by aggregator",accentColor:"blue",onExpandClick:()=>t(!0),filterBar:(0,l.jsxs)("div",{className:"flex space-x-4 items-center",children:[(0,l.jsx)(A.A,{selectedDataType:o,onChange:e=>{i(e)},isCompact:!0}),(0,l.jsx)(S.A,{mode:n,onChange:e=>{c(e)},isCompact:!0})]}),children:(0,l.jsx)(L,{dataType:o,displayMode:n,isModalOpen:e,onModalClose:()=>t(!1)})}),(0,l.jsx)(z.A,{title:"DEX Volume by Source",description:"Volume distribution between direct trades and aggregator-routed trades",accentColor:"orange",onExpandClick:()=>s(!0),filterBar:(0,l.jsx)("div",{className:"flex space-x-4 items-center",children:(0,l.jsx)(S.A,{mode:u,onChange:e=>{d(e)},isCompact:!0})}),children:(0,l.jsx)(X,{displayMode:u,isModalOpen:a,onModalClose:()=>s(!1)})})]})}},27382:(e,t,a)=>{Promise.resolve().then(a.bind(a,23449))}},e=>{var t=t=>e(e.s=t);e.O(0,[4410,5083,166,1182,5955,4685,2897,8441,1684,7358],()=>t(27382)),_N_E=e.O()}]);