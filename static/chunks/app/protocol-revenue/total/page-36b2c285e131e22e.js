(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3995],{1136:(e,t,a)=>{"use strict";a.d(t,{f:()=>r});let l=(e,t)=>{if(!e){console.error("No data available for CSV export"),alert("No data available for export");return}let a=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),console.log("".concat(t," downloaded successfully"))},r=async(e,t,a)=>{a&&a(!0);try{let a=await e();l(a,t)}catch(e){console.error("Error downloading ".concat(t,":"),e),alert("Failed to download data. Please try again.")}finally{a&&a(!1)}}},9154:(e,t,a)=>{"use strict";a.d(t,{RQ:()=>l,Yq:()=>o,fo:()=>n,kj:()=>i,pz:()=>c});let l=async e=>{try{let t=await fetch("https://analytics.topledger.xyz/solana/api/queries/13163/results.json?api_key=S8KkuOqLoYqCIPGstMYVC7zxl84uW7c16KT4nNLH");if(!t.ok)throw Error("API request failed with status ".concat(t.status));let a=await t.json();if(!a.query_result||!a.query_result.data||!a.query_result.data.rows)throw Error("Invalid data structure in API response");console.log("API Response Columns:",a.query_result.data.columns),a.query_result.data.rows.length>0&&console.log("First Row Sample:",a.query_result.data.rows[0]);let l=a.query_result.data.rows.map(e=>{let t={month:String(e.month||""),protocol_revenue:"number"==typeof e.protocol_revenue?e.protocol_revenue:parseFloat(e.protocol_revenue||"0"),cumulative_protocol_revenue:"number"==typeof e.cumulative_protocol_revenue?e.cumulative_protocol_revenue:parseFloat(e.cumulative_protocol_revenue||"0"),Solana_Rev:"number"==typeof e.Solana_Rev?e.Solana_Rev:parseFloat(e.Solana_Rev||"0"),Cumulative_Solana_Rev:"number"==typeof e.Cumulative_Solana_Rev?e.Cumulative_Solana_Rev:parseFloat(e.Cumulative_Solana_Rev||"0")};return e.protocol_revenue||console.log("Null protocol_revenue for month:",e.month),e.Solana_Rev||console.log("Null Solana_Rev for month:",e.month),t}),o=r(l,e);return console.log("Filtered data (".concat(e,"):"),o.length,"rows"),o.sort((e,t)=>new Date(e.month).getTime()-new Date(t.month).getTime())}catch(e){throw console.error("Error fetching protocol revenue data:",e),e}},r=(e,t)=>{if(!e||0===e.length)return[];let a=[...e].sort((e,t)=>new Date(e.month).getTime()-new Date(t.month).getTime()),l=new Date("2024-01-01");return a.filter(e=>new Date(e.month)>=l)},o=(e,t)=>{let a=new Date(e);switch(t){case"D":case"W":return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});case"M":default:return a.toLocaleDateString("en-US",{month:"short",year:"numeric"});case"Q":let l=Math.floor(a.getMonth()/3)+1;return"Q".concat(l," ").concat(a.getFullYear());case"Y":return a.getFullYear().toString()}},n=async()=>{try{let e=await l("Y");if(0===e.length)return{totalProtocolRevenue:0,totalSolanaRevenue:0,protocolRevenuePercentChange:0,solanaRevenuePercentChange:0,isProtocolRevenueIncreasing:!1,isSolanaRevenueIncreasing:!1};let t=[...e].sort((e,t)=>new Date(t.month).getTime()-new Date(e.month).getTime()),a=t[0],r=t[1]||a;console.log("Current month data:",a),console.log("Previous month data:",r);let o=a.cumulative_protocol_revenue,n=a.Cumulative_Solana_Rev,i=s(a.cumulative_protocol_revenue,r.cumulative_protocol_revenue),c=s(a.Cumulative_Solana_Rev,r.Cumulative_Solana_Rev);return console.log("Protocol cumulative revenue % change:",i),console.log("Solana cumulative revenue % change:",c),{totalProtocolRevenue:o,totalSolanaRevenue:n,protocolRevenuePercentChange:Math.abs(i),solanaRevenuePercentChange:Math.abs(c),isProtocolRevenueIncreasing:i>=0,isSolanaRevenueIncreasing:c>=0}}catch(e){return console.error("Error fetching latest stats:",e),{totalProtocolRevenue:0,totalSolanaRevenue:0,protocolRevenuePercentChange:0,solanaRevenuePercentChange:0,isProtocolRevenueIncreasing:!1,isSolanaRevenueIncreasing:!1}}},s=(e,t)=>0===t?0:parseFloat(((e-t)/t*100).toFixed(1)),i=async e=>{try{let t=await l(e);if(!t.length)return"";let a=t.map(t=>[o(t.month,e),t.protocol_revenue.toFixed(2),t.Solana_Rev.toFixed(2)]);return["Date,Protocol Revenue ($),Solana Revenue ($)",...a.map(e=>e.join(","))].join("\n")}catch(e){return console.error("Error preparing CSV data:",e),""}},c=async e=>{try{let t=await l(e);if(!t.length)return"";let a=t.map(t=>[o(t.month,e),t.cumulative_protocol_revenue.toFixed(2),t.Cumulative_Solana_Rev.toFixed(2)]);return["Date,Cumulative Protocol Revenue ($),Cumulative Solana Revenue ($)",...a.map(e=>e.join(","))].join("\n")}catch(e){return console.error("Error preparing cumulative CSV data:",e),""}}},19554:(e,t,a)=>{Promise.resolve().then(a.bind(a,77654))},77654:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ec});var l=a(95155),r=a(12115),o=a(21903),n=a(96565),s=a(79111),i=a(76167),c=a(30832),u=a(4904),d=a(13600),h=a(71734),m=a(59722),f=a(41995),g=a(72630),p=a(58888),v=a(50109),x=a(51078),b=a(7545),j=a(81838),w=a(52594),y=a(42028),S=a(9154);let k={protocolRevenue:"#60a5fa",solanaRevenue:"#a78bfa",grid:"#1f2937",axis:"#374151"},N=e=>e>=1e9?"$".concat(Math.round(e/1e9),"B"):e>=1e6?"$".concat(Math.round(e/1e6),"M"):e>=1e3?"$".concat(Math.round(e/1e3),"K"):"$".concat(Math.round(e)),M=e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},_=e=>e&&0!==e.length?Object.entries(e.reduce((e,t)=>(e[t.month]||(e[t.month]=0),e[t.month]+=t.cumulative_protocol_revenue,e),{})).map(e=>{let[t,a]=e;return{month:t,date:new Date(t),value:a}}):[],C=e=>{let{timeFilter:t="M",isModalOpen:a=!1,onModalClose:o=()=>{},onTimeFilterChange:C,legendsChanged:A}=e,[P,D]=(0,r.useState)([]),[R,L]=(0,r.useState)([]),[E,T]=(0,r.useState)(!0),[F,O]=(0,r.useState)(null),[I,W]=(0,r.useState)(!1),[B,q]=(0,r.useState)(null),Y=(0,r.useRef)(null),[$,z]=(0,r.useState)({visible:!1,dataPoint:null,left:0,top:0}),[U,Q]=(0,r.useState)([]),[V,H]=(0,r.useState)([]),[G,J]=(0,r.useState)(!0),[X,K]=(0,r.useState)(null),[Z,ee]=(0,r.useState)(t),[et,ea]=(0,r.useState)(!1),[el,er]=(0,r.useState)(null),eo=(0,r.useRef)(null),en=(0,r.useCallback)(async()=>{T(!0),O(null);try{let e=await (0,S.RQ)(t);0===e.length?(O("No data available for this period."),D([]),L([])):(D(e),L(e),W(!0),q(null))}catch(t){console.error("Error loading chart data:",t);let e="Failed to load data.";t instanceof Error&&(e=t.message||e),O(e),D([]),L([])}finally{T(!1)}},[t]),es=(0,r.useCallback)(async()=>{J(!0),K(null);try{let e=await (0,S.RQ)(Z);0===e.length?(K("No data available for this period."),Q([]),H([])):(Q(e),H(e),ea(!0),er(null))}catch(t){console.error("Error loading modal chart data:",t);let e="Failed to load data.";t instanceof Error&&(e=t.message||e),K(e),Q([]),H([])}finally{J(!1)}},[Z]);(0,r.useEffect)(()=>{en()},[en]),(0,r.useEffect)(()=>{if(A&&P.length>0){var e,t;A(Object.entries({"Protocol Revenue":{color:k.protocolRevenue,value:null==(e=P[P.length-1])?void 0:e.cumulative_protocol_revenue},"Solana Revenue":{color:k.solanaRevenue,value:null==(t=P[P.length-1])?void 0:t.Cumulative_Solana_Rev}}).map(e=>{let[t,{color:a,value:l}]=e;return{label:t,color:a,value:l}}))}},[P,A]),(0,r.useCallback)(e=>{ee(e),C&&C(e)},[C]),(0,r.useEffect)(()=>{a&&(ee(t),Q(P),H(R.length>0?R:P),er(B),ea(I),es())},[a,t,P,R,B,I,es]),(0,r.useEffect)(()=>{a&&es()},[a,Z,es]);let ei=(0,r.useCallback)((e,t,a,l)=>{if(0===e.length)return -1;let r=Math.floor((t-a)/(l/e.length));return r<0?0:r>=e.length?e.length-1:r},[]),ec=(0,r.useCallback)(function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=null==(t=(a?eo:Y).current)?void 0:t.getBoundingClientRect();if(!l)return;let r=e.clientX-l.left,o=e.clientY-l.top,n={left:60,right:45},s=l.width-n.left-n.right;if(r<n.left||r>s+n.left){$.visible&&z(e=>({...e,visible:!1}));return}let i=a?et?V:U:I?R:P;if(0===i.length)return;let c=ei(i,r,n.left,s);if(-1!==c){let e=i[c],t=!$.dataPoint||$.dataPoint.month!==e.month;!$.visible||t?z({visible:!0,dataPoint:e,left:r,top:o}):z(t=>({...t,dataPoint:e}))}},[P,R,U,V,I,et,$,ei]),eu=(0,r.useCallback)(()=>{$.visible&&z(e=>({...e,visible:!1}))},[$.visible]),ed=(0,r.useCallback)(e=>{if(!e){I&&(q(null),W(!1));return}let{x0:t,x1:a}=e,l=new Date(t),r=new Date(a);!(isNaN(l.getTime())||isNaN(r.getTime()))&&(q([l,r]),I||W(!0))},[I]),eh=(0,r.useCallback)(e=>{if(!e){et&&(er(null),ea(!1));return}let{x0:t,x1:a}=e,l=new Date(t),r=new Date(a);!(isNaN(l.getTime())||isNaN(r.getTime()))&&(er([l,r]),et||ea(!0))},[et]);(0,r.useEffect)(()=>{if(0===P.length){R.length>0&&L([]);return}if(!B&&I)return void L(P);if(!B||!I){R.length!==P.length&&L(P);return}let[e,t]=B,a=e.getTime(),l=t.getTime(),r=P.filter(e=>{let t=new Date(e.month).getTime();return t>=a&&t<=l});L(r.length>0?r:P)},[B,P,I,R.length]),(0,r.useEffect)(()=>{if(0===U.length){V.length>0&&H([]);return}if(!el&&et)return void H(U);if(!el||!et){V.length!==U.length&&H(U);return}let[e,t]=el,a=e.getTime(),l=t.getTime(),r=U.filter(e=>{let t=new Date(e.month).getTime();return t>=a&&t<=l});H(r.length>0?r:U)},[el,U,et,V.length]);let em=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=r?Z:t,n=r?U:P,w=r?et?V:U:I?R:P,C=r?G:E,A=r?X:F,D=r?el:B,L=r?eh:ed;if(C)return(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(x.A,{size:"sm"})});if(A||0===n.length)return(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,l.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:A||"No data available"}),(0,l.jsx)(b.A,{onClick:r?es:en,children:(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(M,{className:"w-3.5 h-3.5"}),(0,l.jsx)("span",{children:"Refresh"})]})})]});let T={top:10,right:15,bottom:30,left:45},O={top:5,right:T.right,bottom:10,left:T.left},Q=_(n);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[$.visible&&$.dataPoint&&(()=>{let e=[{color:k.protocolRevenue,label:"Protocol Revenue",value:N($.dataPoint.cumulative_protocol_revenue),shape:"square"},{color:k.solanaRevenue,label:"Solana Revenue",value:N($.dataPoint.Cumulative_Solana_Rev),shape:"square"}];return(0,l.jsx)(j.A,{title:(0,S.Yq)($.dataPoint.month,o),items:e,top:$.top,left:$.left,isModal:r})})(),(0,l.jsx)("div",{className:"h-[85%] w-full overflow-hidden relative",ref:r?eo:Y,onMouseMove:e=>ec(e,r),onMouseLeave:eu,children:(0,l.jsx)(s.A,{children:e=>{let{width:t,height:a}=e;if(t<=0||a<=0)return null;let r=t-T.left-T.right,o=a-T.top-T.bottom;if(r<=0||o<=0||0===w.length)return null;let n=(0,c.A)({domain:[new Date(w[0].month),new Date(w[w.length-1].month)],range:[0,r]}),s=Math.max(Math.max(...w.map(e=>e.cumulative_protocol_revenue)),Math.max(...w.map(e=>e.Cumulative_Solana_Rev))),x=(0,u.A)({domain:[0,1.1*s],range:[o,0],nice:!0});return(0,l.jsx)("svg",{width:t,height:a,children:(0,l.jsxs)(f.A,{left:T.left,top:T.top,children:[(0,l.jsx)(v.A,{scale:x,width:r,height:o,stroke:k.grid,strokeOpacity:.5,strokeDasharray:"2,3",numTicks:5}),(0,l.jsx)(d.A,{data:w,x:e=>n(new Date(e.month)),y:e=>x(e.cumulative_protocol_revenue),stroke:k.protocolRevenue,strokeWidth:2,curve:i.G}),(0,l.jsx)(d.A,{data:w,x:e=>n(new Date(e.month)),y:e=>x(e.Cumulative_Solana_Rev),stroke:k.solanaRevenue,strokeWidth:2,curve:i.G}),(0,l.jsx)(g.A,{top:o,scale:n,stroke:k.axis,strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,numTicks:Math.min(5,w.length),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"middle",dy:"0.5em"}),tickFormat:e=>e.toLocaleDateString("en-US",{month:"short"})}),(0,l.jsx)(p.A,{scale:x,stroke:k.axis,strokeWidth:.5,tickStroke:"transparent",tickLength:0,numTicks:5,tickFormat:e=>N(e),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dx:"-0.6em",dy:"0.25em"})}),w.map((e,t)=>{let a=n(new Date(e.month)),s=r/w.length;return(0,l.jsx)(h.A,{x:a-s/2,y:0,width:s,height:o,fill:"transparent",onMouseMove:t=>{let a=(0,m.A)(t)||{x:0,y:0};z({visible:!0,dataPoint:e,left:a.x,top:a.y})}},"hover-bar-".concat(t))})]})})}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(y.A,{data:Q,isModal:r,activeBrushDomain:D,onBrushChange:L,onClearBrush:r?()=>{er(null),ea(!1)}:()=>{q(null),W(!1)},getDate:e=>e.date.toISOString(),getValue:e=>e.value,lineColor:k.protocolRevenue,margin:O})})]})};return(0,l.jsxs)("div",{className:"h-full w-full relative",children:[em(0,0),(0,l.jsx)(w.A,{isOpen:a,onClose:o,title:"Cumulative Protocol Revenue",subtitle:"Growth of cumulative protocol revenue and Solana revenue over time",children:(0,l.jsx)("div",{className:"h-[60vh]",children:(0,l.jsxs)("div",{className:"flex h-full",children:[(0,l.jsx)("div",{className:"w-[90%] h-full pr-3 border-r border-gray-900",children:em(0,0,!0)}),(0,l.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:G?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{label:"Loading...",color:"#60a5fa",isLoading:!0}),(0,l.jsx)(n.A,{label:"Loading...",color:"#a78bfa",isLoading:!0})]}):(0,l.jsx)(w.B,{items:[{id:"protocol-revenue",label:"Protocol Revenue",color:k.protocolRevenue},{id:"solana-revenue",label:"Solana Revenue",color:k.solanaRevenue}]})})]})})})]})};var A=a(45191);let P=async()=>{try{let e=await fetch("https://analytics.topledger.xyz/solana/api/queries/13165/results.json?api_key=KcTuHb64zoaF0agKXEOg8XkK0wuJsxD8GjHMU2J5",{next:{revalidate:3600}});if(!e.ok)throw Error("API request failed with status ".concat(e.status));let t=await e.json();if(!t.query_result||!t.query_result.data||!t.query_result.data.rows)throw Error("Invalid data structure in API response");return t.query_result.data.rows}catch(e){throw console.error("Error fetching top protocols revenue data:",e),e}},D=async()=>{try{let e=await P();if(!e||0===e.length)throw Error("No top protocols revenue data available");let t=[...e].sort((e,t)=>t.protocol_revenue-e.protocol_revenue).map(e=>[e.platform,e.protocol_revenue.toFixed(2)]);return["Platform,protocol_revenue_usd",...t.map(e=>e.join(","))].join("\n")}catch(e){throw console.error("Error preparing top protocols CSV:",e),e}},R={Photon:"#34d399",Phantom:"#60a5fa","Pump Fun":"#a78bfa",Raydium:"#f97316",bloxroute:"#fbbf24",BullX:"#fb7185",Trojan:"#c084fc",GMGN:"#94a3b8",Jito:"#86efac",DexScreener:"#7dd3fc",default:"#6b7280"},L=e=>R[e]||R.default,E=e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},T=e=>e>=1e9?"$".concat(Math.round(e/1e9),"B"):e>=1e6?"$".concat(Math.round(e/1e6),"M"):e>=1e3?"$".concat(Math.round(e/1e3),"K"):"$".concat(Math.round(e)),F=e=>{let{isModalOpen:t=!1,onModalClose:a=()=>{},legendsChanged:o}=e,[i,c]=(0,r.useState)([]),[d,m]=(0,r.useState)([]),[S,k]=(0,r.useState)(!0),[N,M]=(0,r.useState)(null),_=(0,r.useRef)(null),C=(0,r.useRef)(null),[D,F]=(0,r.useState)(!1),[O,I]=(0,r.useState)(null),[W,B]=(0,r.useState)(!1),[q,Y]=(0,r.useState)(null),[$,z]=(0,r.useState)({visible:!1,dataPoint:null,left:0,top:0}),U=(0,r.useCallback)(async()=>{k(!0),M(null);try{let e=await P();if(0===e.length)M("No data available for top protocols."),c([]),m([]);else{let t=e.map((t,a)=>({...t,date:new Date(2024,0,1+a*Math.floor(365/e.length))}));c(t),m(t),F(!0),I(null)}}catch(t){console.error("Error loading chart data:",t);let e="Failed to load data.";t instanceof Error&&(e=t.message||e),M(e),c([]),m([])}finally{k(!1)}},[]);(0,r.useEffect)(()=>{U()},[U]),(0,r.useEffect)(()=>{o&&i.length>0&&o(i.slice(0,5).map(e=>({label:e.platform,color:L(e.platform),value:e.protocol_revenue})))},[i,o]);let Q=(0,r.useCallback)(e=>{if(!e){D&&(I(null),F(!1));return}let{x0:t,x1:a}=e;i.length,i.length,i.length,I([new Date(t),new Date(a)]),D||F(!0)},[i.length,D]),V=(0,r.useCallback)(e=>{if(!e){W&&(Y(null),B(!1));return}let{x0:t,x1:a}=e;i.length,i.length,i.length,Y([new Date(t),new Date(a)]),W||B(!0)},[i.length,W]);(0,r.useEffect)(()=>{if(0===i.length){d.length>0&&m([]);return}if(!O&&D)return void m(i);if(!O||!D){d.length!==i.length&&m(i);return}let[e,t]=O,a=i.findIndex(t=>t.date&&t.date.getTime()>=e.getTime()),l=i.findIndex(e=>e.date&&e.date.getTime()>t.getTime()),r=i.slice(a>=0?a:0,l>=0?l:i.length);m(r.length>0?r:i)},[O,i,D,d.length]);let H=(0,r.useCallback)(function(e){var t,a;let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null==(t=(l?C:_).current)?void 0:t.getBoundingClientRect();if(!r)return;let o=e.clientX-r.left,n=D?d:i;if(0===n.length)return;let s={right:15,left:45},c=(r.width-s.left-s.right)/n.length,u=Math.floor((o-s.left)/c);if(u<0||u>=n.length){$.visible&&z(e=>({...e,visible:!1}));return}let h=n[u];$.visible&&(null==(a=$.dataPoint)?void 0:a.platform)===h.platform||z({visible:!0,dataPoint:h,left:o,top:e.clientY-r.top})},[i,d,D,$]),G=(0,r.useCallback)(()=>{$.visible&&z(e=>({...e,visible:!1}))},[$.visible]),J=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=a?W?d:i:D?d:i,o=a?q:O,n=a?V:Q;return S?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(x.A,{size:"sm"})}):N||0===i.length?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,l.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:N||"No data available"}),(0,l.jsx)(b.A,{onClick:U,children:(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(E,{className:"w-3.5 h-3.5"}),(0,l.jsx)("span",{children:"Refresh"})]})})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[$.visible&&$.dataPoint&&(0,l.jsx)(j.A,{title:$.dataPoint.platform,items:[{color:L($.dataPoint.platform),label:"Protocol Revenue",value:T($.dataPoint.protocol_revenue),shape:"square"}],top:$.top,left:$.left,isModal:a}),(0,l.jsx)("div",{className:"h-[85%] w-full overflow-hidden relative",ref:a?C:_,onMouseMove:e=>H(e,a),onMouseLeave:G,children:(0,l.jsx)(s.A,{children:e=>{let{width:t,height:o}=e;if(t<=0||o<=0)return null;let n={top:10,right:15,bottom:30,left:45},s=t-n.left-n.right,i=o-n.top-n.bottom;if(s<=0||i<=0)return null;let c=(0,A.A)({domain:r.map(e=>e.platform),range:[0,s],padding:.2}),d=Math.max(...r.map(e=>e.protocol_revenue)),m=(0,u.A)({domain:[0,1.1*d],range:[i,0],nice:!0}),x=c.bandwidth();return(0,l.jsx)("svg",{width:t,height:o,children:(0,l.jsxs)(f.A,{left:n.left,top:n.top,children:[(0,l.jsx)(v.A,{scale:m,width:s,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),r.map(e=>{var t;let a=i-m(e.protocol_revenue);return(0,l.jsx)(h.A,{x:c(e.platform)||0,y:m(e.protocol_revenue),width:x,height:a,fill:L(e.platform),opacity:(null==(t=$.dataPoint)?void 0:t.platform)===e.platform?1:.75,rx:2},"bar-".concat(e.platform))}),(0,l.jsx)(g.A,{top:i,scale:c,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),tickFormat:e=>a?e.length>12?"".concat(e.substring(0,12),"..."):e:e.length>3?"".concat(e.substring(0,3),"..."):e}),(0,l.jsx)(p.A,{scale:m,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,numTicks:5,tickFormat:e=>T(e),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.5em"})})]})})}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(y.A,{data:i,isModal:a,activeBrushDomain:o,onBrushChange:n,onClearBrush:()=>{a?(Y(null),B(!1)):(I(null),F(!1))},getDate:e=>e.date?e.date.toISOString():"",getValue:e=>e.protocol_revenue,lineColor:R.Photon,margin:{top:5,right:15,bottom:10,left:45}})})]})};return(0,l.jsxs)("div",{className:"h-full w-full relative",children:[J(0,0),(0,l.jsx)(w.A,{isOpen:t,onClose:a,title:"Top Protocols by Revenue",subtitle:"Revenue generated by top protocols since January 2024",children:(0,l.jsx)("div",{className:"h-[70vh]",children:(0,l.jsxs)("div",{className:"flex h-full",children:[(0,l.jsx)("div",{className:"w-[90%] h-full pr-3 border-r border-gray-900",children:J(0,0,!0)}),(0,l.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:S?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{label:"Loading...",color:"#60a5fa",isLoading:!0}),(0,l.jsx)(n.A,{label:"Loading...",color:"#a78bfa",isLoading:!0}),(0,l.jsx)(n.A,{label:"Loading...",color:"#34d399",isLoading:!0})]}):(0,l.jsx)(w.B,{items:i.map(e=>({id:e.platform,label:e.platform,color:L(e.platform)})),maxHeight:600,maxItems:28})})]})})})]})};var O=a(4503),I=a(78398),W=a(37918),B=a(6828);let q=["Telegram Bot","DePIN","Memecoin Trading App","Memecoin LaunchPad","Wallets","Spot Dex","MEV","Infrastructure","NFT Marketplaces","Payments","Borrow and Lending","Others"],Y={"Telegram Bot":B.Tj[0],DePIN:B.Tj[1],"Memecoin Trading App":B.Tj[2],"Memecoin LaunchPad":B.Tj[3],Wallets:B.Tj[4],"Spot Dex":B.Tj[5],MEV:B.Tj[6],Infrastructure:B.Tj[7],"NFT Marketplaces":B.Tj[8],Payments:B.Tj[9],"Borrow and Lending":B.Tj[10],Others:B.Tj[11]},$={"Spot Dex":"Spot Dex","Borrow and Lending":"Borrow and Lending",MEV:"MEV",Payments:"Payments","NFT Marketplaces":"NFT Marketplaces",DePIN:"DePIN",Infrastructure:"Infrastructure","Telegram Bot":"Telegram Bot",Wallets:"Wallets","Memecoin Trading App":"Memecoin Trading App","Memecoin LaunchPad":"Memecoin LaunchPad",Others:"Others"},z=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"W";try{var t,a;console.log("Fetching protocol revenue by segment data with time filter:",e);let l=await fetch("https://analytics.topledger.xyz/solana/api/queries/13168/results?api_key=AhoU1Wq4NS9iHdyeJy6VejNkCIZE5PVSsL2Xg0MM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parameters:{"Date Part":e}})});if(!l.ok)throw Error("API request failed with status ".concat(l.status));let r=await l.json();if(!(null==r||null==(a=r.query_result)||null==(t=a.data)?void 0:t.rows)||!Array.isArray(r.query_result.data.rows))return console.error("Unexpected API response structure"),U(e);console.log("Got ".concat(r.query_result.data.rows.length," rows from API"));let o=[],n=r.query_result.data.rows,s={};return n.forEach(e=>{let t=e.block_date,a=e.Segment,l=parseFloat(e.protocol_revenue)||0,r=$[a]||"Other";s[t]||(s[t]={}),s[t][r]||(s[t][r]=0),s[t][r]+=l}),Object.keys(s).forEach(e=>{q.forEach(t=>{let a=s[e][t]||0;o.push({block_date:e,segment:t,protocol_revenue:a})})}),o.sort((e,t)=>new Date(e.block_date).getTime()-new Date(t.block_date).getTime()),console.log("Processed ".concat(o.length," data points")),o}catch(t){return console.error("Error fetching revenue by segment data:",t),U(e)}},U=e=>{console.log("Generating fallback mock data for time filter:",e);let t=new Date,a=[];if("W"===e)for(let e=3;e>=0;e--){let l=new Date(t);l.setDate(l.getDate()-7*e),a.push(l.toISOString().split("T")[0])}else if("M"===e)for(let e=5;e>=0;e--){let l=new Date(t.getFullYear(),t.getMonth()-e,1);a.push(l.toISOString().split("T")[0])}else if("Q"===e)for(let e=3;e>=0;e--){let l=3*Math.floor(t.getMonth()/3)-3*e,r=new Date(t.getFullYear()+Math.floor((t.getMonth()-l)/12),l,1);a.push(r.toISOString().split("T")[0])}else for(let e=1;e>=0;e--){let l=new Date(t.getFullYear()-e,0,1);a.push(l.toISOString().split("T")[0])}let l=[];return a.forEach(e=>{q.forEach(t=>{let a=1e6;switch(t){case"Spot Dex":a*=1.8;break;case"NFT Marketplaces":a*=1.4;break;case"Memecoin Trading App":a*=1.6;break;case"Memecoin LaunchPad":a*=1.2;break;case"Infrastructure":a*=1.3;break;case"MEV":a*=1.5;break;case"Wallets":a*=.9;break;case"Telegram Bot":a*=.6;break;case"DePIN":a*=1.1;break;case"Payments":a*=.8;break;case"Borrow and Lending":a*=.7;break;case"Others":a*=.4}let r=.8+.4*Math.random();l.push({block_date:e,segment:t,protocol_revenue:Math.round(a*r)})})}),l},Q=e=>Y[e]||B.Tj[9],V=(e,t)=>{let a=new Date(e);return"W"===t?"Week of ".concat(a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})):"M"===t?a.toLocaleDateString("en-US",{month:"short",year:"numeric"}):"Q"===t?"Q".concat(Math.floor(a.getMonth()/3)+1," ").concat(a.getFullYear()):"Y"===t?a.getFullYear().toString():a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},H=(e,t)=>{let a=new Date(e);if("W"===t);else if("M"===t)return a.toLocaleDateString("en-US",{month:"short"});else if("Q"===t)return"Q".concat(Math.floor(a.getMonth()/3)+1);else if("Y"===t)return a.getFullYear().toString();return a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},G=async e=>{try{let t=await z(e);if(!t||0===t.length)throw Error("No revenue by segment data available");let a=[...new Set(t.map(e=>e.block_date))].sort(),l=[...new Set(t.map(e=>e.segment))].sort(),r={};a.forEach(e=>{r[e]={},l.forEach(t=>{r[e][t]=0})}),t.forEach(e=>{r[e.block_date]&&e.segment&&(r[e.block_date][e.segment]=e.protocol_revenue)});let o=["Date",...l],n=a.map(e=>{let t=[e];return l.forEach(a=>{t.push(r[e][a].toFixed(2))}),t});return[o.join(","),...n.map(e=>e.join(","))].join("\n")}catch(e){throw console.error("Error preparing revenue by segment CSV:",e),e}};var J=a(85204);let X=e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},K=e=>{var t;let{timeFilter:a="M",isModalOpen:o=!1,onModalClose:n=()=>{},onTimeFilterChange:i,segmentsChanged:c,displayMode:d,onDisplayModeChange:h}=e,[m,S]=(0,r.useState)([]),[k,N]=(0,r.useState)([]),[M,_]=(0,r.useState)(!0),[C,P]=(0,r.useState)(null),[D,R]=(0,r.useState)(null),[L,E]=(0,r.useState)([]),[T,F]=(0,r.useState)("absolute"),[q,$]=(0,r.useState)("absolute"),U=o?q:d||T;(0,r.useEffect)(()=>{o&&$(d||T)},[o,d,T]);let[G,K]=(0,r.useState)({visible:!1,dataPoint:{},segments:[],left:0,top:0}),Z=(0,r.useRef)(null),ee=e=>{if(!e.length)return console.warn("No API data to process"),{data:[],keys:[]};console.log("Sample data from API:",e.slice(0,2));let t=new Map,l=new Set;if(console.log("Segments from API:",[...new Set(e.map(e=>e.segment))]),e.forEach(e=>{let{block_date:a,segment:r,protocol_revenue:o}=e;if(!a||!r||void 0===o)return void console.warn("Skipping invalid data point:",e);l.add(r),t.has(a)||t.set(a,{});let n=t.get(a);n[r]=(n[r]||0)+o}),0===t.size)return console.warn("No valid data points after processing"),{data:[],keys:[]};console.log("Grouped data into ".concat(t.size," dates with ").concat(l.size," segments"));let r={};Array.from(l).forEach(e=>{for(let[,a]of(r[e]=0,t.entries()))r[e]+=Number(a[e]||0)});let o=Object.entries(r).sort((e,t)=>{let[,a]=e,[,l]=t;return l-a}).map(e=>{let[t]=e;return t});return console.log("Sorted segments:",o),o.forEach(e=>{let t=Y[e]||Q(e);console.log("Segment ".concat(e," color: ").concat(t))}),{data:Array.from(t.entries()).sort((e,t)=>{let[l]=e,[r]=t;if("Q"===a){let e=l.match(/Q(\d+)\s+(\d{4})/),t=r.match(/Q(\d+)\s+(\d{4})/);if(e&&t){let[,a,l]=e,[,r,o]=t;return l!==o?parseInt(l)-parseInt(o):parseInt(a)-parseInt(r)}}else if("Y"===a)return parseInt(l)-parseInt(r);return new Date(l).getTime()-new Date(r).getTime()}).map(e=>{let[t,a]=e,l={date:t};return o.forEach(e=>{l[e]=a[e]||0}),l}),keys:o}};(0,r.useEffect)(()=>{if(c&&k.length>0&&m.length>0){let e={};k.forEach(t=>{e[t]=0,m.forEach(a=>{e[t]+=Number(a[t]||0)})});let t=k.map(t=>({segment:t,color:Y[t]||Q(t),revenue:e[t]||0}));console.log("Sending segment data to parent:",t),c(t)}},[k,m,c]);let et=(0,r.useCallback)(async()=>{_(!0),P(null);try{let e=await z(a);if(console.log("Fetched ".concat(e.length," data points for timeFilter: ").concat(a)),e&&0!==e.length){let t=ee(e);console.log("Processed data has ".concat(t.data.length," points and ").concat(t.keys.length," segments")),t.data.length>0&&console.log("First data point:",t.data[0]),console.log("Segment colors mapping:"),t.keys.forEach(e=>{let t=Y[e]||Q(e);console.log("".concat(e,": ").concat(t))}),S(t.data),E(t.data),N(t.keys)}else console.error("No data returned for timeFilter: ".concat(a)),P("No data available for ".concat("Q"===a?"Quarterly":"Y"===a?"Yearly":a," view")),S([]),N([]),E([])}catch(e){console.error("Error fetching data:",e),P("Failed to load data"),S([]),N([]),E([])}finally{_(!1)}},[a]);(0,r.useEffect)(()=>{et()},[et]),(0,r.useEffect)(()=>{if(!m.length)return;if(!D)return void E(m);let[e,t]=D,a=m.filter(a=>{let l=new Date(a.date).getTime();return l>=e.getTime()&&l<=t.getTime()});E(a.length>0?a:m)},[D,m]);let ea=(0,r.useCallback)(e=>{if(!e)return void R(null);let{x0:t,x1:a}=e;R([new Date(t),new Date(a)])},[]),el=(0,r.useCallback)(()=>{G.visible&&K(e=>({...e,visible:!1}))},[G.visible]),er=(0,r.useCallback)(e=>{let t=null;if(o){let a=e.target;for(;a&&!a.classList.contains("overflow-hidden");)a=a.parentElement;t=a}else t=Z.current;if(!t)return;let a=t.getBoundingClientRect(),l=e.clientX-a.left,r=e.clientY-a.top,n={right:25,left:45},s=a.width-n.left-n.right;if(l<n.left||l>a.width-n.right){G.visible&&K(e=>({...e,visible:!1}));return}let i=s/L.length,c=Math.floor((l-n.left)/i);c<0&&(c=0),c>=L.length&&(c=L.length-1);let u=L[c];if(u){var d;let e=!(null==(d=G.dataPoint)?void 0:d.date)||G.dataPoint.date!==u.date;!G.visible||e?K({visible:!0,dataPoint:u,segments:k,left:l,top:r}):K(e=>({...e,left:l,top:r}))}},[L,k,G.visible,null==(t=G.dataPoint)?void 0:t.date,o]),eo=(0,r.useCallback)(()=>"absolute"===U?L:L.map(e=>{let t={date:e.date},a=k.reduce((t,a)=>t+(Number(e[a])||0),0);if(a>0){let l={},r=0;k.forEach(t=>{let o=(Number(e[t])||0)/a*100;l[t]=o,r+=o});let o=r>0?100/r:1;k.forEach(e=>{t[e]=l[e]*o})}else k.forEach(e=>{t[e]=0});return t}),[U,L,k]),en=e=>"absolute"!==U?"".concat(Math.round(e),"%"):e>=1e9?"$".concat((e/1e9).toFixed(+(e%1e9!=0)),"B"):e>=1e6?"$".concat((e/1e6).toFixed(+(e%1e6!=0)),"M"):e>=1e3?"$".concat((e/1e3).toFixed(+(e%1e3!=0)),"K"):"$".concat(Math.round(e)),es=e=>{try{return H(e,a)}catch(t){return console.error("Error formatting date: ".concat(e),t),e}},ei=e=>{try{return V(e,a)}catch(t){return console.error("Error formatting date: ".concat(e),t),e}},ec=e=>e.map(e=>({date:e.date,value:k.reduce((t,a)=>t+(Number(e[a])||0),0)})),eu=()=>{if(M)return(0,l.jsx)("div",{className:"flex justify-center items-center h-full w-full",children:(0,l.jsx)(x.A,{size:"sm"})});if(C||!L.length)return(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-full w-full",children:[(0,l.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:C||"No data available"}),(0,l.jsx)(b.A,{onClick:et,children:(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(X,{className:"w-3.5 h-3.5"}),(0,l.jsx)("span",{children:"Refresh"})]})})]});let e=eo(),t=ec(m),r={top:10,right:15,bottom:30,left:45};return(0,l.jsxs)("div",{className:"h-full w-full relative",children:[G.visible&&G.dataPoint&&!o&&(0,l.jsx)(j.A,{title:ei(G.dataPoint.date),items:G.segments.filter(e=>Number(G.dataPoint[e]||0)>0).filter((e,t,a)=>a.indexOf(e)===t).map(e=>({color:Y[e]||Q(e),label:e,value:en(Number(G.dataPoint[e]||0)),shape:"square"})),top:G.top,left:G.left}),(0,l.jsx)("div",{className:"h-[85%] w-full overflow-hidden relative",ref:o?null:Z,onMouseMove:er,onMouseLeave:el,children:(0,l.jsx)(s.A,{children:t=>{let{width:o,height:n}=t,s=o-r.left-r.right,i=n-r.top-r.bottom,c=(0,A.A)({domain:e.map(e=>e.date),padding:.2,range:[0,s]});console.log("X-axis domain values:",c.domain());let d=(0,u.A)({domain:"percent"===U?[0,100]:[0,1.1*Math.max(...e.map(e=>k.reduce((t,a)=>t+(Number(e[a])||0),0)))],nice:!0,range:[i,0]});return(0,I.A)({domain:k,range:k.map(e=>Y[e]||Q(e))}),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("svg",{width:o,height:n,children:(0,l.jsxs)(f.A,{left:r.left,top:r.top,children:[(0,l.jsx)(v.A,{scale:d,width:s,height:i,stroke:B.Vg,strokeOpacity:.5,strokeDasharray:"2,3",numTicks:4}),(0,l.jsx)(O.A,{data:e,keys:k,x:e=>e.date,xScale:c,yScale:d,color:e=>Y[e]||Q(e),children:t=>t.map(t=>t.bars.map(a=>{var r;if(a.height<=0)return null;let o=G.visible&&(null==(r=G.dataPoint)?void 0:r.date)===e[a.index].date;return(0,l.jsx)("rect",{x:a.x,y:a.y,height:a.height,width:a.width,fill:Y[t.key]||Q(t.key),opacity:o?1:.75,rx:2},"bar-stack-".concat(t.index,"-").concat(a.index))}).filter(Boolean))}),(0,l.jsx)(g.A,{top:i,scale:c,tickFormat:es,stroke:B.h5,strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,tickLabelProps:()=>({fill:B.Dc,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"middle",dy:"0.5em"}),tickValues:"Q"===a||"Y"===a?e.map(e=>e.date):e.length>10?e.filter((t,a)=>a%Math.ceil(e.length/10)==0).map(e=>e.date):e.map(e=>e.date)}),(0,l.jsx)(p.A,{scale:d,stroke:B.h5,strokeWidth:.5,tickStroke:"transparent",tickLength:0,tickFormat:e=>en(e),tickLabelProps:()=>({fill:B.Dc,fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dx:"-0.6em",dy:"0.25em"}),numTicks:4})]})})})}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(y.A,{data:t,activeBrushDomain:D,onBrushChange:ea,onClearBrush:()=>R(null),getDate:e=>e.date,getValue:e=>e.value,lineColor:Y.DeFi,margin:{top:5,right:15,bottom:10,left:45}})})]})};return(0,l.jsxs)(l.Fragment,{children:[eu(),o&&(0,l.jsxs)(w.A,{isOpen:o,onClose:n,title:"Protocol Revenue by Segment",subtitle:"Stacked view of protocol revenue across segments by time period",children:[(0,l.jsxs)("div",{className:"flex pl-1 py-0 mb-3",children:[(0,l.jsx)(W.A,{value:a,onChange:i||(()=>{}),options:[{value:"W",label:"W"},{value:"M",label:"M"},{value:"Q",label:"Q"},{value:"Y",label:"Y"}]}),(0,l.jsx)(J.A,{mode:U,onChange:e=>{o?($(e),console.log("Modal display mode changed to: ".concat(e))):h?(h(e),console.log("External display mode changed to: ".concat(e))):(F(e),console.log("Internal display mode changed to: ".concat(e)))}})]}),(0,l.jsx)("div",{className:"h-px bg-gray-900 w-full mb-3"}),(0,l.jsx)("div",{className:"h-[60vh]",children:(0,l.jsxs)("div",{className:"flex h-full",children:[(0,l.jsxs)("div",{className:"w-[90%] h-full pr-3 border-r border-gray-900 relative",children:[o&&G.visible&&G.dataPoint&&(0,l.jsx)(j.A,{title:ei(G.dataPoint.date),items:G.segments.filter(e=>Number(G.dataPoint[e]||0)>0).filter((e,t,a)=>a.indexOf(e)===t).map(e=>({color:Y[e]||Q(e),label:e,value:en(Number(G.dataPoint[e]||0)),shape:"square"})),top:G.top,left:G.left,isModal:!0}),eu()]}),(0,l.jsx)("div",{className:"flex flex-col gap-1 overflow-y-auto max-h-[500px] pr-1",children:(0,l.jsx)(w.B,{items:k.map(e=>({id:e,label:e,color:Y[e]||Q(e)}))})})]})})]})]})},Z=async()=>{try{var e,t;console.log("Fetching dapp revenue data");let a=await fetch("https://analytics.topledger.xyz/solana/api/queries/13241/results.json?api_key=gpgdCtoDOhHa2fc4FPd0NfwiCFfaREWflZ3knXJ3");if(!a.ok)throw Error("API request failed with status ".concat(a.status));let l=await a.json();if(!(null==l||null==(t=l.query_result)||null==(e=t.data)?void 0:e.rows)||!Array.isArray(l.query_result.data.rows))throw Error("Unexpected API response structure");let r=l.query_result.data.rows.map(e=>({dapp:e.Dapp||"",segment:e.Segment||"",protocol_revenue:parseFloat(e.protocol_revenue)||0,segment_revenue:parseFloat(e.segment_revenue)||0}));return console.log("Processed ".concat(r.length," dapp revenue data points")),r}catch(e){return console.error("Error fetching dapp revenue data:",e),[]}},ee=async()=>{try{let e=await Z();if(!e||0===e.length)throw Error("No dapp revenue data available");let t={},a={};e.forEach(e=>{t[e.dapp]||(t[e.dapp]=0,a[e.dapp]=e.segment),t[e.dapp]+=e.protocol_revenue});let l=Object.entries(t).sort((e,t)=>t[1]-e[1]).map(e=>{let[t]=e;return t}).map(e=>[e,a[e],t[e].toFixed(2)]);return["Dapp,Segment,protocol_revenue_usd",...l.map(e=>e.join(","))].join("\n")}catch(e){throw console.error("Error preparing dapp revenue CSV:",e),e}},et=e=>{let{className:t="w-4 h-4"}=e;return(0,l.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},ea={Photon:"#92efbc",BullX:"#92efbc",Trojan:"#9757ff","bloom trading bot":"#c990ff",Maestro:"#60a5fa",Phantom:"#ffc480",Raydium:"#c990ff",Axiom:"#7dd3fc","Pump.Fun AMM":"#9b7b6a",Orca:"#7dd3fc","Pump Fun":"#ffc480",Moonshot:"#92efbc","makenow.meme":"#9757ff",GMGN:"#9757ff",DexScreener:"#fe855f","Moonshot.money":"#ffb0a0",bloxroute:"#a7f3a0",Metaplex:"#9757ff",Jito:"#fe855f",magiceden:"#1e1e1e",tensorswap:"#635985","Tribe run":"#8cb8c2",DEXTools:"#9b7b6a",prerich:"#f9a8d4",looter:"#4a5569","Jupiter DCA":"#9b7b6a",Helium:"#7b5644",Hivemapper:"#1e1e30",Helio:"#3d6699",rainfi:"#dba88f","Sol Trading Bot":"#fbbf24",default:"#6b7280"},el=e=>0===e?"$0":e>=1e9?"$".concat(Math.round(e/1e9),"B"):e>=1e6?"$".concat(Math.round(e/1e6),"M"):e>=1e3?"$".concat(Math.round(e/1e3),"K"):e<1&&e>0?"$".concat(e.toFixed(2)):"$".concat(Math.round(e)),er=e=>ea[e]||ea.default,eo=e=>{let t=Object.entries(e.reduce((e,t)=>(e[t.segment]||(e[t.segment]=0),e[t.segment]+=t.protocol_revenue,e),{})).sort((e,t)=>t[1]-e[1]).slice(0,10).map(e=>{let[t]=e;return t});return Object.values(e.filter(e=>t.includes(e.segment)).reduce((e,t)=>(e[t.segment]||(e[t.segment]={segment:t.segment,date:t.date}),e[t.segment][t.dapp]=(e[t.segment][t.dapp]||0)+t.protocol_revenue,e),{})).sort((e,t)=>{let a=Object.keys(e).filter(e=>"segment"!==e&&"date"!==e).reduce((t,a)=>t+e[a],0);return Object.keys(t).filter(e=>"segment"!==e&&"date"!==e).reduce((e,a)=>e+t[a],0)-a})},en=e=>{let{isModalOpen:t=!1,onModalClose:a=()=>{},legendsChanged:o}=e,[i,c]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[m,S]=(0,r.useState)([]),[k,N]=(0,r.useState)([]),[M,_]=(0,r.useState)(!0),[C,P]=(0,r.useState)(null),D=(0,r.useRef)(null),R=(0,r.useRef)(null),[L,E]=(0,r.useState)(!1),[T,F]=(0,r.useState)(null),[O,I]=(0,r.useState)(!1),[W,B]=(0,r.useState)(null),[q,Y]=(0,r.useState)({visible:!1,segment:"",dapps:[],left:0,top:0}),[$,z]=(0,r.useState)([]),[U,Q]=(0,r.useState)([]),[V,H]=(0,r.useState)(!0),[G,J]=(0,r.useState)(null),[X,K]=(0,r.useState)([]),ee=(0,r.useCallback)(async()=>{_(!0),P(null);try{let e=await Z();if(0===e.length)P("No data available."),c([]),h([]),S([]),N([]),K([]);else{let t=e.map((t,a)=>({...t,date:new Date(2024,0,1+a*Math.floor(365/e.length))}));[...new Set(t.map(e=>e.dapp))];let a=t.reduce((e,t)=>(e[t.dapp]||(e[t.dapp]=0),e[t.dapp]+=t.protocol_revenue,e),{}),l=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,35).map(e=>{let[t]=e;return t});K(l);let r=eo(t);if(c(t),h(r),S(t),N(r),E(!0),F(null),o){let e=l.map(e=>({label:e,color:er(e),value:t.filter(t=>t.dapp===e).reduce((e,t)=>e+t.protocol_revenue,0)}));o(e)}}}catch(t){console.error("Error loading chart data:",t);let e="Failed to load data from API.";t instanceof Error&&(e=t.message||e),P(e),c([]),h([]),S([]),N([]),K([])}finally{_(!1)}},[o]),en=(0,r.useCallback)(async()=>{H(!0),J(null);try{let e=await Z();if(0===e.length)J("No data available."),z([]),Q([]);else{let t=e.map((t,a)=>({...t,date:new Date(2024,0,1+a*Math.floor(365/e.length))})),a=eo(t);z(t),Q(a),I(!0),B(null)}}catch(t){console.error("Error loading modal chart data:",t);let e="Failed to load data from API.";t instanceof Error&&(e=t.message||e),J(e),z([]),Q([])}finally{H(!1)}},[]);(0,r.useEffect)(()=>{ee()},[ee]),(0,r.useEffect)(()=>{t&&en()},[t,en]);let es=(0,r.useCallback)(e=>{if(!e){L&&(F(null),E(!1));return}let{x0:t,x1:a}=e;i.length,i.length,i.length,F([new Date(t),new Date(a)]),L||E(!0)},[i.length,L]),ei=(0,r.useCallback)(e=>{if(!e){O&&(B(null),I(!1));return}let{x0:t,x1:a}=e;$.length,$.length,$.length,B([new Date(t),new Date(a)]),O||I(!0)},[$.length,O]);(0,r.useEffect)(()=>{if(0===i.length){m.length>0&&(S([]),N([]));return}if(!T&&L){S(i),N(d);return}if(!T||!L){m.length!==i.length&&(S(i),N(d));return}let[e,t]=T,a=i.findIndex(t=>t.date&&t.date.getTime()>=e.getTime()),l=i.findIndex(e=>e.date&&e.date.getTime()>t.getTime()),r=i.slice(a>=0?a:0,l>=0?l:i.length),o=eo(r);S(r.length>0?r:i),N(o.length>0?o:d)},[T,i,d,L,m.length]);let ec=(0,r.useCallback)(function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=null==(t=(a?R:D).current)?void 0:t.getBoundingClientRect();if(!l)return;let r=e.clientX-l.left,o=a?U:L?k:d;if(0===o.length)return;let n={right:15,left:45},s=(l.width-n.left-n.right)/o.length,i=Math.floor((r-n.left)/s);if(i<0||i>=o.length){q.visible&&Y(e=>({...e,visible:!1}));return}let c=o[i];if(!q.visible||q.segment!==c.segment){let t=X.filter(e=>c[e]>0).map(e=>({name:e,value:c[e],color:er(e)})).sort((e,t)=>t.value-e.value);Y({visible:!0,segment:c.segment,dapps:t,left:r,top:e.clientY-l.top})}},[X,d,k,U,q.visible,q.segment,L,O]),eu=(0,r.useCallback)(()=>{q.visible&&Y(e=>({...e,visible:!1}))},[q.visible]),ed=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=a?U:L?k:d,o=a?$:i,n=a?V:M,c=a?G:C,h=a?W:T,m=a?ei:es;return n?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(x.A,{size:"sm"})}):c||0===r.length?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,l.jsx)("div",{className:"text-gray-400/80 text-xs mb-2",children:c||"No data available"}),(0,l.jsx)(b.A,{onClick:ee,children:(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(et,{className:"w-3.5 h-3.5"}),(0,l.jsx)("span",{children:"Refresh"})]})})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[q.visible&&(0,l.jsx)(j.A,{title:q.segment,items:q.dapps.map(e=>({color:e.color,label:e.name,value:el(e.value),shape:"square"})),top:q.top,left:q.left,isModal:a}),(0,l.jsx)("div",{className:"h-[85%] w-full overflow-hidden relative",ref:a?R:D,onMouseMove:e=>ec(e,a),onMouseLeave:eu,children:(0,l.jsx)(s.A,{children:e=>{let{width:t,height:o}=e;if(t<=0||o<=0)return null;let n={top:10,right:15,bottom:30,left:45},s=t-n.left-n.right,i=o-n.top-n.bottom;if(s<=0||i<=0)return null;let c=r.map(e=>e.segment),d=(0,A.A)({domain:c,range:[0,s],padding:.2}),h=Math.max(...r.map(e=>X.reduce((t,a)=>t+(e[a]||0),0))),m=(0,u.A)({domain:[0,1.1*h],range:[i,0],nice:!0});return(0,l.jsx)("svg",{width:t,height:o,children:(0,l.jsxs)(f.A,{left:n.left,top:n.top,children:[(0,l.jsx)(v.A,{scale:m,width:s,stroke:"#1f2937",strokeOpacity:.5,strokeDasharray:"2,3"}),r.map((e,t)=>{let a=e.segment,r=d(a)||0,o=d.bandwidth(),n=i,s=[];return X.filter(t=>e[t]>0).sort((t,a)=>e[t]-e[a]).forEach(c=>{let u=e[c]||0;if(u>0){let e=i-m(u);n-=e,s.push((0,l.jsx)("rect",{x:r,y:n,width:o,height:e,fill:er(c),opacity:q.segment===a?1:.75,rx:2},"bar-".concat(t,"-").concat(c)))}}),(0,l.jsx)(f.A,{children:s},"segment-".concat(t))}),(0,l.jsx)(g.A,{top:i,scale:d,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",hideAxisLine:!1,tickLength:0,tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,textAnchor:"middle",dy:"0.5em"}),tickFormat:e=>a?e.length>12?"".concat(e.substring(0,12),"..."):e:e.length>3?"".concat(e.substring(0,3),"..."):e}),(0,l.jsx)(p.A,{scale:m,stroke:"#374151",strokeWidth:.5,tickStroke:"transparent",tickLength:0,hideZero:!0,numTicks:5,tickFormat:e=>el(e),tickLabelProps:()=>({fill:"#6b7280",fontSize:11,fontWeight:300,letterSpacing:"0.05em",textAnchor:"end",dy:"0.33em",dx:"-0.5em"})})]})})}})}),(0,l.jsx)("div",{className:"h-[15%] w-full mt-1",children:(0,l.jsx)(y.A,{data:o,isModal:a,activeBrushDomain:h,onBrushChange:m,onClearBrush:()=>{a?(B(null),I(!1)):(F(null),E(!1))},getDate:e=>e.date?e.date.toISOString():"",getValue:e=>e.protocol_revenue,lineColor:ea.Photon,margin:{top:5,right:15,bottom:10,left:45}})})]})};return(0,l.jsxs)("div",{className:"h-full w-full relative",children:[ed(0,0),(0,l.jsx)(w.A,{isOpen:t,onClose:a,title:"Protocol Revenue by Segment",subtitle:"Revenue breakdown by segment, grouped by dapp",children:(0,l.jsx)("div",{className:"h-[70vh]",children:(0,l.jsxs)("div",{className:"flex h-full",children:[(0,l.jsx)("div",{className:"w-[90%] h-full pr-3 border-r border-gray-900",children:ed(0,0,!0)}),(0,l.jsx)("div",{className:"w-[10%] h-full pl-3 flex flex-col justify-start items-start",children:M?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{label:"Loading...",color:"#60a5fa",isLoading:!0}),(0,l.jsx)(n.A,{label:"Loading...",color:"#a78bfa",isLoading:!0}),(0,l.jsx)(n.A,{label:"Loading...",color:"#34d399",isLoading:!0})]}):(0,l.jsx)(w.B,{items:X.map(e=>(i.filter(t=>t.dapp===e).reduce((e,t)=>e+t.protocol_revenue,0),{id:e,label:e,color:er(e)})),maxHeight:600,maxItems:28})})]})})})]})};var es=a(1136),ei=a(82229);function ec(){let[e,t]=(0,r.useState)("M"),[a,s]=(0,r.useState)("absolute"),[i,c]=(0,r.useState)([]),[u,d]=(0,r.useState)([{label:"Protocol Revenue",color:"#60a5fa"},{label:"Solana Revenue",color:"#a78bfa"}]),[h,m]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[p,v]=(0,r.useState)([]),[x,b]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[y,k]=(0,r.useState)(!1),[N,M]=(0,r.useState)(!1),[_,A]=(0,r.useState)(!1),[P,R]=(0,r.useState)(!1),[L,E]=(0,r.useState)(!1),[T,O]=(0,r.useState)(!1),[I,B]=(0,r.useState)(!1),q=e=>void 0===e?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact",compactDisplay:"short",maximumFractionDigits:1}).format(e),Y=e=>{("W"===e||"M"===e||"Q"===e||"Y"===e)&&t(e)},$=async()=>{P||await (0,es.f)(()=>(0,S.pz)(e),"cumulative-revenue-".concat(e.toLowerCase(),".csv"),R)},z=async()=>{L||await (0,es.f)(D,"top-protocols-revenue.csv",E)},U=async()=>{T||await (0,es.f)(()=>G(e),"revenue-by-segment-".concat(e.toLowerCase(),".csv"),O)},Q=async()=>{I||await (0,es.f)(ee,"dapp-revenue.csv",B)};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,l.jsx)(o.A,{title:"Cumulative Revenue Growth",description:"Growth of cumulative protocol revenue and Solana revenue over time",accentColor:"blue",onExpandClick:()=>b(!0),onDownloadClick:$,isDownloading:P,legendWidth:"1/4",className:"h-[500px]",legend:(0,l.jsx)(l.Fragment,{children:u.map(e=>(0,l.jsx)(n.A,{label:e.label,color:e.color,shape:"square",tooltipText:e.value?q(e.value):void 0},e.label))}),children:(0,l.jsx)(C,{timeFilter:e,isModalOpen:x,onModalClose:()=>b(!1),onTimeFilterChange:e=>Y(e)})}),(0,l.jsx)(o.A,{title:"Top Protocol by Revenue",description:"Revenue generated by top protocols since January 2024",accentColor:"green",onExpandClick:()=>w(!0),onDownloadClick:z,isDownloading:L,legendWidth:"1/4",className:"h-[500px]",legend:(0,l.jsx)(l.Fragment,{children:h.map(e=>(0,l.jsx)(n.A,{label:e.label,color:e.color,shape:"square",tooltipText:e.value?q(e.value):void 0},e.label))}),children:(0,l.jsx)(F,{isModalOpen:j,onModalClose:()=>w(!1),legendsChanged:m})})]}),(0,l.jsxs)("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,l.jsx)(o.A,{title:"Revenue by Segment",description:"Protocol revenue breakdown by segment over time",accentColor:"purple",onExpandClick:()=>k(!0),onDownloadClick:U,isDownloading:T,legendWidth:"1/5",className:"h-[500px]",filterBar:(0,l.jsxs)("div",{className:"flex flex-wrap gap-3 items-center",children:[(0,l.jsx)(W.A,{value:e,onChange:Y,options:[{value:"W",label:"W"},{value:"M",label:"M"},{value:"Q",label:"Q"},{value:"Y",label:"Y"}]}),(0,l.jsx)(J.A,{mode:a,onChange:e=>s(e),isCompact:!0})]}),legend:(0,l.jsx)(l.Fragment,{children:f.map(e=>(0,l.jsx)(n.A,{label:e.label,color:e.color,shape:"square",tooltipText:e.value?q(e.value):void 0},e.label))}),children:(0,l.jsx)(K,{timeFilter:e,displayMode:a,isModalOpen:y,onModalClose:()=>k(!1),onTimeFilterChange:Y,segmentsChanged:(0,r.useCallback)(e=>{g(e.map(e=>({label:e.segment,color:e.color,value:e.revenue})))},[])})}),(0,l.jsx)(o.A,{title:"Protocol Revenue by Segment",description:"Revenue breakdown by segment, grouped by dapp",accentColor:"orange",onExpandClick:()=>M(!0),onDownloadClick:Q,isDownloading:I,legendWidth:"1/4",className:"h-[500px]",legend:(0,l.jsx)(l.Fragment,{children:p.length>0?p.map(e=>(0,l.jsx)(n.A,{label:e.label,color:e.color,shape:"square",tooltipText:e.value?q(e.value):void 0},e.label)):(0,l.jsx)(n.A,{label:"Loading...",color:"#ffc480",isLoading:!0})}),children:(0,l.jsx)(en,{isModalOpen:N,onModalClose:()=>M(!1),legendsChanged:v})})]}),(0,l.jsx)(ei.default,{pageId:"total"})]})}},81838:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(95155);a(12115);let r=e=>{let{type:t,color:a}=e;return"circle"===t?(0,l.jsx)("div",{className:"h-2 w-2 rounded-full mr-1.5",style:{backgroundColor:a}}):(0,l.jsx)("div",{className:"h-2 w-2 rounded-sm mr-1.5",style:{backgroundColor:a}})},o=(e,t)=>{if(/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{2}\/\d{2}\/\d{4}/.test(e)){let a=new Date(e);if(!isNaN(a.getTime())){if("W"===t)return"Week of ".concat(a.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}));if("M"===t)return a.toLocaleDateString("en-US",{month:"short",year:"numeric"});if("Q"===t){let e=Math.floor(a.getMonth()/3)+1;return"Q".concat(e,", ").concat(a.getFullYear())}else if("Y"===t)return a.getFullYear().toString();return a.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})}}return/^[A-Za-z]{3}\s\d{4}$/.test(e)||/^Q[1-4]\s\d{4}$/.test(e)||/^\d{4}$/.test(e),e},n=(e,t)=>{if("string"==typeof e){if(t){let a={USD:"$",EUR:"€",GBP:"\xa3",JPY:"\xa5",CNY:"\xa5",SOL:"SOL"},l=a[t]||t;if("SOL"===t){if(e.includes("SOL"))return e;for(let[t,l]of Object.entries(a))if("SOL"!==t&&e.startsWith(l))return"".concat(e.substring(l.length)," SOL");return"".concat(e," SOL")}for(let[r,o]of Object.entries(a))if(e.startsWith(o)&&r!==t)return e.replace(o,l)}return e}if("number"==typeof e){if(t)switch(t){case"USD":return"$".concat(e.toLocaleString());case"EUR":return"€".concat(e.toLocaleString());case"GBP":return"\xa3".concat(e.toLocaleString());case"JPY":case"CNY":return"\xa5".concat(e.toLocaleString());case"SOL":return"".concat(e.toLocaleString()," SOL");default:return"".concat(t).concat(e.toLocaleString())}return e.toLocaleString()}return String(e)},s=e=>{let{title:t,items:a,top:s,left:i,isModal:c=!1,timeFilter:u,currencyFilter:d}=e,h=a.some(e=>e.axis),m=o(t,u);return(0,l.jsxs)("div",{className:"absolute z-10 pointer-events-none bg-gray-900/95 shadow-lg border border-gray-800 rounded-md p-2 text-xs min-w-[120px]",style:{top:"".concat(s,"px"),left:i>(c?500:250)?"".concat(i-160,"px"):"".concat(i+10,"px"),transform:"translateY(-100%)"},children:[(0,l.jsx)("div",{className:"text-gray-400 text-[10px] font-normal pb-1 mb-1 border-b border-gray-800",children:m}),(0,l.jsx)("div",{className:"space-y-1",children:a.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center text-gray-400",children:[(0,l.jsx)(r,{type:e.shape||"circle",color:e.color}),(0,l.jsx)("span",{className:"text-gray-400 font-normal ml-2",children:e.label}),h&&e.axis&&(0,l.jsxs)("span",{className:"ml-1 text-[9px] text-gray-500",children:["(",e.axis," axis)"]})]}),(0,l.jsx)("span",{className:"text-gray-300 font-normal ml-4",children:n(e.value,d)})]},"tooltip-item-".concat(t)))})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4410,5083,166,1182,5955,8925,4685,3414,2207,2229,8441,1684,7358],()=>t(19554)),_N_E=e.O()}]);